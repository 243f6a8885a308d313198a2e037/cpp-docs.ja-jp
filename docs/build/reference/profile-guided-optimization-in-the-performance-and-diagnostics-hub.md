---
title: "Profile Guided Optimization パフォーマンスと診断ハブで |Microsoft ドキュメント"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-tools
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: C++
ms.assetid: dc3a1914-dbb6-4401-bc63-10665a8c8943
caps.latest.revision: "12"
author: corob-msft
ms.author: corob
manager: ghogen
ms.openlocfilehash: e462fb157f035be275e6d97b9ccb35e136c24d4f
ms.sourcegitcommit: ebec1d449f2bd98aa851667c2bfeb7e27ce657b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2017
---
# <a name="profile-guided-optimization-in-the-performance-and-diagnostics-hub"></a>パフォーマンスと診断ハブでのガイド付き最適化のプロファイル
パフォーマンスと診断ハブで Visual C++ 用ガイド付き最適化のプロファイル プラグインを使用すると、アプリの開発時に、ガイド付き最適化のプロファイル エクスペリエンスを合理化できます。 実行できます[プラグインをダウンロード](http://go.microsoft.com/fwlink/p/?LinkId=327915)Visual Studio の web サイトからです。  
  
 ガイド付き最適化のプロファイル (PGO: Profile Guided Optimization) を使用すると、ユーザーとの対話を最適化した形で、x86 および x64 のネイティブ アプリのビルドを作成できます。 PGO は複数手順のプロセスです。まず、プロファイリング用にインストルメント化されたアプリ ビルドを作成します。次に、インストルメント化されたアプリを通常のユーザー操作のシナリオで実行することにより、"トレーニング" を実行します。 キャプチャされたプロファイル データを保存して、プログラム全体を最適化するためのガイドとして結果を使用し、アプリを再構築します。 これらの手順を個々に Visual Studio またはコマンド ラインで実行することもできますが、PGO プラグインを使用すると、プロセスを一元化および単純化することができます。 PGO プラグインにより、必要なオプションがすべて設定され、各手順のガイドおよび分析結果が示されます。また、その結果を使用してビルドを構成することで、各関数のサイズまたは速度が最適化されます。 PGO プラグインを使用すると、コードの変更に伴って、アプリのトレーニングを再実行し、ビルド最適化データを更新することも容易になります。  
  
## <a name="prerequisites"></a>必須コンポーネント  
 行う必要があります[PGO プラグインをダウンロード](http://go.microsoft.com/fwlink/p/?LinkId=327915)し、パフォーマンスと診断ハブで使用する前に Visual Studio でインストールします。  
  
## <a name="walkthrough-using-the-pgo-plug-in-to-optimize-an-app"></a>チュートリアル: PGO プラグインを使用してアプリを最適化する  
 まず、Visual Studio で基本的な Win32 デスクトップ アプリを作成します。 最適化対象のネイティブ アプリが既にある場合は、それを使用できるため、この手順を省略できます。  
  
#### <a name="to-create-an-app"></a>アプリを作成するには  
  
1.  メニュー バーで、 **[ファイル]**、 **[新規作成]**、 **[プロジェクト]**の順にクリックします。  
  
2.  左側のウィンドウで、**新しいプロジェクト**] ダイアログ ボックスで、展開**インストール**、**テンプレート**、 **Visual C**、し、[ **MFC**です。  
  
3.  中央のウィンドウで次のように選択します。 **MFC アプリケーション**です。  
  
4.  プロジェクトの名前を指定 — たとえば、 **SamplePGOProject**— で、**名前**ボックス。 **[OK]** を選択します。  
  
5.  **概要**のページ、 **MFC アプリケーション ウィザード** ダイアログ ボックスで、選択、**完了**ボタンをクリックします。  
  
 次に、アプリのビルド構成を [リリース] に設定します。これにより、PGO ビルドおよびトレーニングの手順用の準備が完了します。  
  
#### <a name="to-set-the-build-configuration"></a>ビルド構成を設定するには  
  
1.  メニュー バーで **[ビルド]**、 **[構成マネージャー]**の順に選択します。  
  
2.  **Configuration Manager**  ダイアログ ボックスで、選択、**アクティブ ソリューション構成**ドロップダウン ボタンを選択**リリース**です。 選択、**閉じる**ボタンをクリックします。  
  
 パフォーマンスと診断ハブを開く: メニュー バーで、次のように選択します。**分析**、**パフォーマンスと診断**です。 これにより、プロジェクトの種類に応じた分析ツールのある診断セッション ページが開きます。  
  
 ![パフォーマンスと診断ハブでの PGO](../../build/reference/media/pgofig0hub.png "PGOFig0Hub")  
  
 **使用可能なツール**、select、**ガイド付き最適化のプロファイル**チェック ボックスをオンします。 選択、**開始**PGO プラグインを開始するボタンをクリックします。  
  
 ![PGO の [説明] ページ](../../build/reference/media/pgofig1start.png "PGOFig1Start")  
  
 **ガイド付き最適化のプロファイル**ページには、手順、アプリのパフォーマンスを向上させるためにプラグインで使用がについて説明します。 選択、**開始**ボタンをクリックします。  
  
 ![PGO [インストルメンテーション] ページ](../../build/reference/media/pgofig2instrument.png "PGOFig2Instrument")  
  
 **インストルメンテーション** セクションを使用する、**トレーニングが最初に有効になっている**トレーニングの一部として、アプリの開始フェーズを含めるかどうかを選択するオプションです。 このチェック ボックスをオフにした場合、トレーニングを明示的に有効にするまで、実行中のインストルメント化されたアプリでは、トレーニング データが記録されません。  
  
 選択、**インストルメント**特別なコンパイラ オプションのセットを使用してアプリケーションをビルドするボタンをクリックします。 コンパイラにより、生成されたコードにプローブ命令が挿入されます。 これらの命令により、トレーニング フェーズでプロファイル データが記録されます。  
  
 ![PGO のインストルメント化されたビルド ページ](../../build/reference/media/pgofig3build.PNG "PGOFig3Build")  
  
 インストルメント化されたアプリのビルドが完了すると、アプリは自動的に起動されます。  
  
 ビルド中にエラーまたは警告が発生した場合、これらを修正し、**ビルド再起動**をインストルメント化されたビルドを再起動します。  
  
 アプリが開始されたときに行うこともできます、**トレーニングの開始**と**Pause トレーニング**でリンク、**トレーニング**プロファイル情報が記録されるタイミングを制御する」セクション。 使用することができます、**アプリケーションの停止**と**スタート アプリケーション**へのリンクを停止し、アプリを再起動します。  
  
 ![PGO トレーニング ページ](../../build/reference/media/pgofig4training.PNG "PGOFig4Training")  
  
 トレーニングでは、ユーザー シナリオに従った操作を行い、PGO プラグインでコードを最適化するために必要なプロファイル情報をキャプチャします。 アプリを閉じるかを選択して、トレーニングを完了すると、**アプリケーションの停止**リンクします。 選択、**分析**分析の手順を開始するボタンをクリックします。  
  
 分析が完了したら、 **Analysis**セクションは、ユーザー シナリオ トレーニング フェーズ中にキャプチャされたプロファイル情報のレポートを表示します。 このレポートを使用して、アプリから最も頻繁に呼び出され、最も長い時間が消費された関数を調べることができます。 PGO プラグインでは、この情報を使用して、速度を最適化するアプリ関数およびサイズを最適化するアプリ関数を判断します。 PGO プラグインでは、トレーニングで記録したユーザー シナリオに応じて、最も高速で最小サイズのアプリを作成できるように、ビルドの最適化が構成されます。  
  
 ![PGO 分析ページ](../../build/reference/media/pgofig5analyze.png "PGOFig5Analyze")  
  
 トレーニングが必要なプロファイル情報をキャプチャできます**Save Changes**を将来のビルドを最適化するために、プロジェクトの分析済みのプロファイル データを保存します。 プロファイル データを破棄し、トレーニングを最初からやり直すを選択して**やり直しトレーニング**です。  
  
 プロファイル データ ファイルがプロジェクトに保存された、 **PGO トレーニング データ**フォルダーです。 このデータは、アプリのコンパイラ ビルド最適化設定を制御するために使用されます。  
  
 ![ソリューション エクスプ ローラーでデータ ファイルの PGO](../../build/reference/media/pgofig6data.png "PGOFig6Data")  
  
 コンパイル時にアプリが選択的に最適化されるように、分析の後、PGO プラグインによってプロジェクトのビルド オプションが設定されます。 引き続き同じプロファイル データを使用して、アプリの変更およびビルドを行うことができます。 アプリケーションのビルド時には、プロファイル データを使用して最適化された関数および命令の数を示すレポートが出力されます。  
  
 ![PGO の出力診断](../../build/reference/media/pgofig7diagnostics.png "PGOFig7Diagnostics")  
  
 開発時に大幅なコード変更を行った場合、最適化の効果を最大限に高めるには、アプリを再トレーニングする必要があります。 ビルドにより出力されたレポートに、プロファイル データを使用して最適化された関数または命令が 80% 未満であると示されている場合は、アプリの再トレーニングを行うことをお勧めします。