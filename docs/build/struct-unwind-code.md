---
title: 構造体 UNWIND_CODE |マイクロソフトのドキュメント
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-tools
ms.topic: conceptual
dev_langs:
- C++
ms.assetid: 104955d8-7e33-4c5a-b0c6-3254648f0af3
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: 1da6f078741c598099e71da9164f54b56da3f355
ms.sourcegitcommit: 92f2fff4ce77387b57a4546de1bd4bd464fb51b6
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/17/2018
ms.locfileid: "45726649"
---
# <a name="struct-unwindcode"></a>構造体 UNWIND_CODE

アンワインド コード配列を使用して、不揮発性レジスタと RSP に影響を与えるプロローグ内で一連の操作を記録します。 各コード項目では、次の形式があります。

|||
|-|-|
|UBYTE|プロローグ内のオフセット|
|UBYTE: 4|アンワインド コードの操作|
|UBYTE: 4|操作情報|

配列は、プロローグ内のオフセットの降順で並べ替えられます。

## <a name="offset-in-prolog"></a>プロローグ内のオフセット

この操作では、+ 1 (つまり、次の命令の開始のオフセット) を実行する命令の終わりのプロローグの先頭からのオフセットします。

## <a name="unwind-operation-code"></a>アンワインド コードの操作

注: 特定のオペレーション コードには、ローカルのスタック フレームの値を符号なしのオフセットが必要です。 このオフセットは固定のスタック割り当ての先頭 (最も低いアドレス) です。 Unwind_info フレーム登録フィールドが 0 の場合、このオフセットは RSP からです。 フレームの登録 フィールドが 0 以外の場合は、これは、RSP があった場所 FP レジスタが確立されたときからのオフセット。 これは、場合、FP reg オフセットを引いた FP レジスタになります (16\*フレーム unwind_info オフセットを登録する)。 FP レジスタが使用されている場合、アンワインド コードのオフセットを取得する必要がありますのみ使用 FP レジスタがプロローグで確立された後。

除くすべてのオペコードの`UWOP_SAVE_XMM128`と`UWOP_SAVE_XMM128_FAR`オフセットには、8 の倍数は必ず、(スタック自体は 16 バイトでアラインでは常に) 8 バイト境界に、関心のある値が格納されているため、すべてのスタックします。 短いオフセット (512 K 未満) を使用するオペレーション コード、このコードのノードの最後の USHORT は 8 で割った値のオフセットを保持します。 時間のオフセットを使用するオペレーション コードを (512 K < = < 4 GB のオフセット)、このコードの最後の 2 つ USHORT ノード (リトル エンディアン形式) でのオフセットを保持します。

オペコードの`UWOP_SAVE_XMM128`と`UWOP_SAVE_XMM128_FAR`、128 ビットのすべての XMM 操作は、16 バイトのアラインされたメモリで発生する必要がありますので、オフセットは、16 の倍数を必ずします。 16 のスケール ファクターを使用するため、`UWOP_SAVE_XMM128`より小さい 1 m 分のオフセットが許可されます。

アンワインド操作コードは、次のいずれかです。

`UWOP_PUSH_NONVOL` (0) 1 つのノード

不揮発性の整数レジスタ、8 でデクリメント RSP をプッシュします。 操作情報は、レジスタの数です。 エピローグでは、上の制約のために注意してください、`UWOP_PUSH_NONVOL`アンワインド コードがプロローグ内の先頭し、同様に、最後のアンワインド コード配列にする必要があります。 この相対順序を除くその他のすべてのアンワインド コードに適用されます`UWOP_PUSH_MACHFRAME`します。

`UWOP_ALLOC_LARGE` (1) 2 または 3 つのノード

スタックのサイズの大きい領域を割り当てます。 2 つの形式があります。 操作情報には、0 の場合で割った値割り当てのサイズと等しい 8 は、512 K - 8 まで割り当てを許可する、[次へ] のスロットに記録されます。 操作情報が 1 と等しいかどうかは、割り当て、リトル エンディアン形式で次の 2 つのスロットに、割り当てのサイズはスケーリングが記録された最大 4 GB - 8。

`UWOP_ALLOC_SMALL` (2) 1 つのノード

スタック上の小規模な領域を割り当てます。 割り当てのサイズは、操作情報 フィールド\*8 + 8、8 から 128 バイトの割り当てを許可します。

スタック割り当てのアンワインド コードは、最短エンコードを常に使用する必要があります。

|**アロケーション サイズ**|**アンワインド コード**|
|-|-|
|8 ~ 128 バイト|`UWOP_ALLOC_SMALL`|
|136 を 512 K に 8 バイト|`UWOP_ALLOC_LARGE`、操作情報 = 0|
|512 K に 4 G-8 バイト|`UWOP_ALLOC_LARGE`、操作情報 = 1|

`UWOP_SET_FPREG` (3) 1 つのノード

フレーム ポインター レジスタを確立するには、現在 RSP のオフセットをレジスタに設定します。 オフセットが UNWIND_INFO の登録のフレーム オフセット (スケール) フィールドに等しい\*16 の 240 の 0 からのオフセット。 オフセットの使用は、命令の短い形式を使用する複数のアクセスを許可することでコードの密度を支援する、固定のスタック割り当ての中央を指すフレーム ポインターの確立を許可します。 操作情報のフィールドは予約されており、使用する必要がありますに注意してください。

`UWOP_SAVE_NONVOL` (4) 2 つのノード

MOV を使用して、プッシュではなく、スタック上には、不揮発性の整数レジスタを保存します。 これは主に使用シュリンク、不揮発性レジスタが割り当てられていた位置でスタックに保存されています。 操作情報は、レジスタの数です。 次の 8 のスケールのスタックのオフセットが記録された上記の注で説明されているように、操作コードのスロットをアンワインドします。

`UWOP_SAVE_NONVOL_FAR` (5) 3 つのノード

プッシュではなく MOV を使用して、長いオフセットを使用してスタック上には、不揮発性の整数レジスタを保存します。 これは主に使用シュリンク、不揮発性レジスタが割り当てられていた位置でスタックに保存されています。 操作情報は、レジスタの数です。 スケールなしのスタックのオフセットが、次に、記録された上記の注で説明されている 2 つのアンワインド操作コードのスロット。

`UWOP_SAVE_XMM128` (8) 2 つのノード

スタック上には、不揮発性の XMM レジスタの 128 ビットすべてを保存します。 操作情報は、レジスタの数です。 16 のスケールのスタックのオフセットは、次のスロットに記録されます。

`UWOP_SAVE_XMM128_FAR` (9) 3 つのノード

時間のオフセットを使用してスタック上には、不揮発性の XMM レジスタの 128 ビットすべてを保存します。 操作情報は、レジスタの数です。 スケールなしのスタックのオフセットは、次の 2 つのスロットに記録されます。

`UWOP_PUSH_MACHFRAME` (10) 1 つのノード

マシンのフレームをプッシュします。  これは、ハードウェアの割り込みまたは例外の効果を記録に使用されます。 2 つの形式があります。 操作情報が 0 の場合、次にプッシュされましたスタック。

|||
|-|-|
|RSP + 32|SS|
|RSP + 24|古い RSP|
|RSP + 16|立てる|
|RSP + 8|CS|
|RSP|RIP|

操作情報が 1 では、次は代わりにプッシュされました: 場合

|||
|-|-|
|RSP + 40|SS|
|RSP + 32|古い RSP|
|RSP + 24|立てる|
|RSP + 16|CS|
|RSP + 8|RIP|
|RSP|エラー コード|

このアンワインド コードは、これが実際に実行されるが、代わりに、割り込みルーチンの実際のエントリ ポイントの前に表示され、マシン フレームのプッシュをシミュレートする場所を提供することのみが存在するダミーのプロローグで常に表示されます。 `UWOP_PUSH_MACHFRAME` コンピューターが、次の概念的にが実行を示します、そのシミュレーションを記録します。

1. RIP のリターン アドレスにスタックの一番上からのポップ*Temp*

2. プッシュ SS

3. 古い RSP をプッシュします。

4. プッシュ立てる

5. プッシュ CS

6. プッシュ*Temp*

7. (Op 情報では、1 と等しい) 場合は、エラー コードをプッシュします。

シミュレートされた`UWOP_PUSH_MACHFRAME`40 操作デクリメント RSP (op 情報は、0 に等しい) または 48 (op 情報が 1 と等しくなります)。

## <a name="operation-info"></a>操作情報

これらの 4 ビットの意味は、オペレーション コードに依存します。 汎用的な (整数) の登録をエンコードするには、次のマッピングが使用されます。

|||
|-|-|
|0|RAX|
|1|RCX|
|2|RDX|
|3|RBX|
|4|RSP|
|5|RBP|
|6|RSI|
|7|RDI|
|8 ~ 15|R15 に R8|

## <a name="see-also"></a>関連項目

[例外処理とデバッガー サポートのためのアンワインド データ](../build/unwind-data-for-exception-handling-debugger-support.md)