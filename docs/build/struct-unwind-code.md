---
title: 構造体 UNWIND_CODE |Microsoft ドキュメント
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-tools
ms.topic: conceptual
dev_langs:
- C++
ms.assetid: 104955d8-7e33-4c5a-b0c6-3254648f0af3
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: 068acacf88e9ac968b34c26bf76657fd33adf4f3
ms.sourcegitcommit: be2a7679c2bd80968204dee03d13ca961eaa31ff
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/03/2018
ms.locfileid: "32390100"
---
# <a name="struct-unwindcode"></a>構造体 UNWIND_CODE
アンワインド コード配列を使用して、不揮発性レジスタおよび RSP 影響を与えるプロローグ内で一連の操作を記録します。 各コード項目には、次の形式があります。  
  
|||  
|-|-|  
|UBYTE|プロローグ内のオフセット|  
|UBYTE: 4|アンワインド コードの操作|  
|UBYTE: 4|情報の操作|  
  
 配列は、プロローグ内のオフセットの降順で並べ替えられます。  
  
 **プロローグ内のオフセット**  
 この操作は、+ 1 (つまり、次の命令の開始オフセット) を実行する命令の終わりのプロローグの先頭からのオフセットします。  
  
 **アンワインド コードの操作**  
 注: 特定のオペレーション コードでは、ローカルのスタック フレームの値を符号なしのオフセットが必要です。 このオフセットは、固定のスタック割り当ての開始 (最も低いアドレス) です。 Unwind_info フレーム レジスタ フィールドが 0 の場合は、このオフセットは RSP です。 フレーム レジスタ フィールドが 0 以外の場合は、これは、RSP があった場所 FP レジスタが確立されたときからのオフセット。 これは、場合、FP reg オフセットを引いた FP レジスタになります (16 * スケール調節されたフレーム unwind_info オフセットを登録する)。 FP レジスタが使用されている場合、アンワインド コード オフセットする必要がありますのみ使用 FP レジスタがプロローグ内で確立された後。  
  
 UWOP_SAVE_XMM128 と UWOP_SAVE_XMM128_FAR を除くすべてオペコードの場合は、(スタック自体は、常に 16 バイトでアライン) 8 バイト境界に関心のあるすべてのスタックの値が格納されているために、オフセットが 8 の倍数を必ずです。 短いオフセット (512 K 未満) を使用するオペレーション コードでは、このコードのノードの最後の USHORT は 8 で割った値のオフセットを保持します。 長いオフセットを使用するオペレーション コードの (512 K < = < 4 GB をオフセット)、このコードの 2 つの最終的な USHORT ノードは、リトル エンディアン形式で) オフセットを保持します。  
  
 UWOP_SAVE_XMM128 および UWOP_SAVE_XMM128_FAR オペコードは、128 ビット XMM のすべての操作は、16 バイトのアラインされたメモリで発生する必要がありますので、オフセットが、16 の倍数を必ずです。 そのため、16 のスケール ファクターは UWOP_SAVE_XMM128、M が 1 未満のオフセットが許可に使用されます。  
  
 アンワインド操作コードでは、次のいずれかです。  
  
 UWOP_PUSH_NONVOL (0) 1 つのノード  
  
 8 でデクリメント RSP 不揮発性の整数レジスタをプッシュします。 操作情報は、レジスタの数です。 注意してください、エピローグ上の制約のため UWOP_PUSH_NONVOL アンワインド コードする必要がありますプロローグ内で最初に表示同じように、アンワインド コード配列の最後します。 この相対順序は、UWOP_PUSH_MACHFRAME を除く他のすべてのアンワインド コードに適用されます。  
  
 UWOP_ALLOC_LARGE (1) 2 または 3 つのノード  
  
 スタック上の大規模の多くの領域を割り当てます。 2 つの形式があります。 操作情報には、0 の場合で割った値割り当てのサイズと等しい 8 は、512 K - 8 まで割り当てを許可する次のスロットに記録されます。 情報の操作が 1 と等しいかどうかは、割り当て、リトル エンディアン形式で次の 2 つのスロットでスケールなしの割り当てのサイズが記録された最大 4 GB、8 です。  
  
 UWOP_ALLOC_SMALL (2) 1 つのノード  
  
 スタックに小型の領域を割り当てます。 割り当てのサイズは、オペレーション情報フィールド * 8 + 8 が 128 バイト 8 からの割り当てを許可します。  
  
 スタック割り当てのアンワインド コードは、最短エンコードを常に使用する必要があります。  
  
|||  
|-|-|  
|**割り当てサイズ**|**アンワインド コード**|  
|8 ~ 128 バイト|UWOP_ALLOC_SMALL|  
|136 ~ 512-8 kb|UWOP_ALLOC_LARGE、情報の操作 = 0|  
|512 K に 4 G-8 バイト|UWOP_ALLOC_LARGE、情報の操作 = 1|  
  
 UWOP_SET_FPREG (3) 1 つのノード  
  
 フレーム ポインター レジスタを確立するには、現在の RSP のオフセットをレジスタに設定します。 オフセットが unwind_info フレーム レジスタ オフセット (スケーリング) フィールドと等しい * 16、240 0 からのオフセットを許可します。 オフセットの使用は、短い命令フォームを使用する複数のアクセスを許可することでコードの密度を支援する、固定のスタック割り当ての中央を指すフレーム ポインターの確立を許可します。 操作情報フィールドは予約されており、使用しないでことに注意してください。  
  
 UWOP_SAVE_NONVOL (4) 2 つのノード  
  
 プッシュではなく MOV を使用して、スタック上には、不揮発性整数レジスタを保存します。 これは、主に使用シュリンク ラップ、不揮発性レジスタが割り当てられていた位置でスタックに保存されています。 操作情報は、レジスタの数です。 8 の拡大/縮小スタック オフセットは、次の記録上のノードでの説明に従って、操作コード スロットをアンワインドします。  
  
 UWOP_SAVE_NONVOL_FAR (5) 3 つのノード  
  
 スタックにプッシュではなく MOV を使用して、長いオフセットの不揮発性整数レジスタを保存します。 これは、主に使用シュリンク ラップ、不揮発性レジスタが割り当てられていた位置でスタックに保存されています。 操作情報は、レジスタの数です。 スケールなしのスタック オフセットは、次の記録前の注で説明されている 2 つのアンワインド操作コードのスロット。  
  
 UWOP_SAVE_XMM128 (8) 2 つのノード  
  
 スタック上には、不揮発性 XMM レジスタの 128 ビットすべてを保存します。 操作情報は、レジスタの数です。 16 の拡大/縮小スタック オフセットは、次のスロットに記録されます。  
  
 UWOP_SAVE_XMM128_FAR (9) 3 つのノード  
  
 長いオフセットでスタック上には、不揮発性 XMM レジスタの 128 ビットすべてを保存します。 操作情報は、レジスタの数です。 スケールなしのスタックのオフセットは、次の 2 つのスロットに記録されます。  
  
 UWOP_PUSH_MACHFRAME (10) 1 つのノード  
  
 マシン フレームをプッシュします。  これを使用して、ハードウェア割り込みや例外の影響を記録します。 2 つの形式があります。 情報の操作が 0 の場合、次に出されたスタック。  
  
|||  
|-|-|  
|RSP + 32|SS|  
|RSP + 24|古い RSP|  
|RSP + 16|立てる|  
|RSP + 8|CS|  
|RSP|RIP|  
  
 次に出された代わりに、情報の操作が 1 と等しい: 場合  
  
|||  
|-|-|  
|RSP + 40|SS|  
|RSP + 32|古い RSP|  
|RSP + 24|立てる|  
|RSP + 16|CS|  
|RSP + 8|RIP|  
|RSP|エラー コード|  
  
 このアンワインド コードは、これが実行されることはありませんが、代わりに、割り込みルーチンの実際のエントリ ポイントの前に表示され、マシン フレームのプッシュをシミュレートする場所を提供することのみが存在するダミーのプロローグで常に表示されます。 UWOP_PUSH_MACHFRAME そのシミュレーションでは、コンピューターが概念的には次の作業完了、ことを示しますが記録されます。  
  
 RIP のリターン アドレスをスタックの一番上からのポップ*Temp*  
  
 プッシュ SS  
  
 プッシュ古い RSP  
  
 プッシュ立てる  
  
 プッシュ CS  
  
 プッシュ*Temp*  
  
 (オペレーション情報が 1 に等しい) 場合は、エラー コードをプッシュします。  
  
 40 によってシミュレートされた UWOP_PUSH_MACHFRAME 操作デクリメント RSP (op 情報は、0 に等しい) または 48 (op 情報が 1 と等しくなります)。  
  
 **情報の操作**  
 これらの 4 ビットの意味は、操作コードによって異なります。 汎用的な (整数) レジスタをエンコードするには、次のマッピングを使用します。  
  
|||  
|-|-|  
|0|RAX|  
|1|RCX|  
|2|RDX|  
|3|RBX|  
|4|RSP|  
|5|RBP|  
|6|RSI|  
|7|RDI|  
|8 ~ 15|R15 に R8|  
  
## <a name="see-also"></a>関連項目  
 [例外処理とデバッガー サポートのためのアンワインド データ](../build/unwind-data-for-exception-handling-debugger-support.md)