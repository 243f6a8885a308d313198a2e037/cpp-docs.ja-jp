---
title: アンワインド プロシージャ
ms.date: 11/04/2016
ms.assetid: 82c5d0ca-70be-4d1a-a306-bfe01c29159f
ms.openlocfilehash: 2d68a5c3fb1cc2d18b587d1419b0103d02b35a7f
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/31/2018
ms.locfileid: "50523108"
---
# <a name="unwind-procedure"></a>アンワインド プロシージャ

アンワインド コード配列は降順に並べ替えられます。 例外が発生する場合は、完全なコンテキストがコンテキスト レコードのオペレーティング システムによって格納されます。 例外ディスパッチ ロジックが呼び出されて、例外ハンドラーを検索する次の手順を繰り返し実行します。

1. 現在の関数 (または連鎖 UNWIND_INFO エントリの場合、関数の部分) を記述する RUNTIME_FUNCTION テーブル エントリを検索するには、コンテキスト レコードに格納されている現在の RIP を使用します。

1. 関数テーブルのエントリが見つからない場合は、リーフ関数内にあるし、RSP は戻り値のポインターを直接アドレスします。 [RSP] の戻りポインターが更新されたコンテキストに格納されている、シミュレートされた RSP が 8 ずつインクリメントされ、手順 1. が繰り返されます。

1. 関数のテーブルのエントリが見つかると、RIP エピローグ内)、b)、プロローグ内、または c) 例外ハンドラーによって処理されるコードで 3 つのリージョン内であることができます。

   - 大文字と小文字の) かどうか、RIP に、エピローグ内にあるし、コントロールは、関数を離れることが必要があります、この関数は、この例外に関連付けられている例外ハンドラーも、呼び出し元関数のコンテキストを計算するエピローグの効果を続行する必要があります。 RIP エピローグ、RIP からコード ストリーム内にあるかどうかを調べるが調べられます。 コード ストリームを正規のエピローグの末尾の部分に一致させることができ、エピローグでは、エピローグの残りの部分がシミュレートされる、コンテキスト レコードがそれぞれの命令として更新が処理されます。 その後、手順 1. が繰り返されます。

   - 関数がケース b) コントロールはありませんが、RIP がプロローグ内にある場合、入力や必要があります、この関数は、この例外に関連付けられている例外ハンドラーを呼び出し元関数のコンテキストの計算にプロローグの効果を元に戻す必要があります。 RIP はプロローグ内では、取り込みには、関数の開始からの距離がプロローグのアンワインド情報でエンコードされたサイズに等しいまたはそれよりも小さい場合。 アンワインド コード配列の最初のエントリのオフセットで小さい関数の開始の RIP のオフセットと等しいかそれよりも、転送をスキャンして、アンワインド コード配列内のすべての残りの項目の効果を元に戻す、プロローグの効果がアンワインドされました。 手順 1 が繰り返されます。

   - ケース c)、RIP がプロローグまたはエピローグと、関数内にない場合は例外ハンドラー (が存在する UNW_FLAG_EHANDLER が設定されます)、し、言語固有のハンドラーが呼び出されます。 ハンドラーがそのデータをスキャンし、フィルターとして適切な関数を呼び出します。 言語固有のハンドラーには、例外が処理されたこと、または検索は、次回に続くを返すことができます。 アンワインドは、直接それも開始できます。

1. 言語固有のハンドラーが処理済みのステータスを返しますとしている場合、実行が継続元のコンテキスト レコードを使用します。

1. 言語固有のハンドラーがないか、ハンドラーは、"検索を続行する の状態を返しますの場合は、コンテキスト レコードが、呼び出し元の状態をアンワインドしてください。 これは、それぞれの効果を元に戻す、アンワインド コード配列要素のすべてを処理することによって実現されます。 手順 1 が繰り返されます。

チェーン アンワインド情報が含まれる、基本的な手順が実行されます。 唯一の違いには、配列の末尾に達すると、プロローグの効果をアンワインドするアンワインド コード配列をウォーク、しにリンクされている親のアンワインド情報と、そこで見つかった全体のアンワインド コード配列を走査します。 このリンクにより、アンワインド情報 UNW_CHAINED_INFO フラグなしに到着するまで継続され、そのアンワインド コード配列のウォークを終了します。

最小限のアンワインド データは 8 バイトです。 これはのみ以下の場合、またはスタックの 128 バイトを割り当てられ、可能性がある 1 つの不揮発性レジスタを保存する関数を表します。 これは、チェーンのサイズでもないアンワインド コードを長さ 0 のプロローグのアンワインド情報。

## <a name="see-also"></a>関連項目

[例外処理 (x64)](../build/exception-handling-x64.md)