---
title: "ATL OLE DB コンシューマー ウィザード | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "reference"
f1_keywords: 
  - "vc.codewiz.class.atl.consumer.overview"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "ATL OLE DB コンシューマー ウィザード"
  - "ATL プロジェクト, 追加 (ATL OLE DB コンシューマーを)"
  - "接続文字列 [C++], OLE DB コンシューマー"
ms.assetid: dcb68ed1-2224-422f-9f7b-108a74864204
caps.latest.revision: 13
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 13
---
# ATL OLE DB コンシューマー ウィザード
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

このウィザードでは、指定した OLEDB プロバイダーを通して指定したデータ ソースにアクセスするために必要なデータ連結が設定された OLEDB コンシューマー クラスを作成します。  
  
> [!NOTE]
>  このウィザードでは、**\[データ ソース\]** をクリックしてデータ ソースを選択してから、\[`クラス`\] フィールドと \[.h ファイル\] フィールドに名前を入力する必要があります。  
  
## UIElement の一覧  
 **Data Source**  
 **\[データ ソース\]** オプションでは、OLE DB プロバイダーを指定して、選択したデータ ソースを設定できます。  このボタンをクリックすると、**\[データ リンク プロパティ\]** ダイアログ ボックスが表示されます。  接続文字列の作成と **\[データ リンク プロパティ\]** ダイアログ ボックスの詳細については、[!INCLUDE[winsdkshort](../../atl/reference/includes/winsdkshort_md.md)] ドキュメントの「[Data Link API Overview](https://msdn.microsoft.com/en-us/library/ms718102.aspx)」を参照してください。  
  
> [!NOTE]
>  以前のリリースでは、Shift キーを押しながら **\[データ ソース\]** ボタンをクリックすると \[ファイルを開く\] ダイアログが表示され、データ リンク \(.udl\) ファイルを選択できました。  現在のリリースでは、この機能はサポートされていません。  
  
 このダイアログ ボックスには以下の 4 つのタブがあります。  
  
-   \[プロバイダー\] タブ  
  
-   **\[接続\]** タブ  
  
-   **\[詳細設定\]** タブ  
  
-   **\[すべて\]** タブ  
  
     **\[データ リンク プロパティ\]** ダイアログ ボックスのタブの詳細については、以下のトピックを参照してください。  
  
     **\[OK\]** をクリックして終了します。  \[データベース オブジェクトの選択\] ダイアログ ボックスが表示されます。  このダイアログ ボックスでは、コンシューマーが使用するテーブル、ビュー、またはストアド プロシージャを選択します。  
  
     **プロバイダー**  
     データ ソースへの接続を管理する適切なプロバイダーを選択します。  プロバイダーの種類は、通常は接続するデータベースの種類によって決定します。  `Next` ボタンをクリックするか、**\[接続\]** タブをクリックします。  
  
     **\[接続\]**  
     このタブの内容は、選択したプロバイダーによって異なります。  プロバイダーの種類は多数ですが、このセクションでは、2 つの一般的な接続である SQL と ODBC データについて説明します。  それ以外は、ここで説明するフィールドに似た変化形です。  
  
     SQL データの場合:  
  
    1.  **\[サーバー名の選択または入力\]** ドロップダウン リスト メニューをクリックすると、ネットワークに登録されたすべてのデータ サーバーが表示されるので、その 1 つを選択します。  
  
    2.  **\[サーバーにログオンするための情報の入力\]** データ サーバーにログオンするためのユーザー名およびパスワードを入力します。  
  
    3.  **\[サーバー上のデータベースを選択する\]** ドロップダウン リスト メニューをクリックすると、データ サーバーに登録されたすべてのデータベースが表示されるので、その 1 つを選択します。  
  
         または  
  
         **\[データベース ファイルをデータベース名として添付する\]** データベースとして使用できるファイルを指定して、明示的なパス名を入力します。  
  
        > [!NOTE]
        >  \[データ リンク プロパティ\] ダイアログ ボックスの \[パスワードを保存する\] の機能には、セキュリティ上の問題があります。  \[サーバーにログオンするための情報の入力\] には、次の 2 つのオプション ボタンがあります。  
  
         **\[Windows NT の統合セキュリティを使用する\]**  
  
         **\[特定のユーザー名とパスワードを使用する\]**  
  
         \[特定のユーザー名とパスワードを使用する\] をクリックすると、パスワード保存用のオプション \(\[パスワードを保存する\]  nのチェック ボックス\) を使用できますが、このオプションにはセキュリティ上の問題があります。  \[Windows NT の統合セキュリティを使用する\] を選択することをお勧めします。このオプションではパスワードが暗号化されるため、安全です。  
  
         \[パスワードを保存する\] を選択する場合も考えられます。たとえば、プライベート データベース ソリューションによってライブラリをリリースしている場合、データベースには直接アクセスしないで、代わりに中間層アプリケーションを使用して \(選択した認証スキームによって\) ユーザーを確認し、そのユーザーが利用できるデータの種類を制限します。  
  
         ODBC データの場合:  
  
         1.  **\[データ ソースを指定します\]** データ ソース名、または接続文字列を使用できます。  
  
         **\[データ ソース名を使用する\]** このドロップダウン リストには、コンピューターに登録されているデータ ソースが表示されます。  [ODBC Data Source Administrator](!Alink("dasdkODBCDataSourceAdmin"))を使用すると、事前にデータ ソースをセットアップできます。または **\[接続文字列を使用する\]** 既に取得した接続文字列を入力するか、**\[ビルド\]** ボタンをクリックします。**\[データ ソースの選択\]** ダイアログ ボックスが表示されます。  ファイルまたはコンピューターのデータ ソースを選択して、**\[OK\]** をクリックします。  
  
        > [!NOTE]
        >  サーバー エクスプローラーで既存の接続のプロパティを表示すると、接続文字列を取得できます。また、サーバー エクスプローラーで **\[接続の追加\]** をダブルクリックすると、接続を作成できます。  
  
         2.  **\[サーバーにログオンするための情報の入力\]** データ サーバーにログオンするためのユーザー名およびパスワードを入力します。  
  
         3.  使用する初期カタログを入力します。  
  
         4.  \[テスト接続\] をクリックし、テストに合格したら、**\[OK\]** をクリックします。  合格しなかった場合はログオン情報を確認し、別のデータベース、または別のデータ サーバーで試してみます。  
  
     **\[詳細\]**  
     **\[ネットワーク設定\]** [Impersonation level](!Alink("_com_Impersonation_Levels")) \(サーバーがクライアントの権限を借用するときに使用できる権限借用レベルで、RPC 偽装レベルに直接対応する\) および "保護レベル" \(クライアントとサーバーの間で送信されるデータに対する保護レベルで、RPC 保護レベルに直接対応する\) を指定します。  
  
     **\[その他\]** \[接続の時間切れ\] で、タイムアウトが発生するまでのアイドル時間の秒数を指定します。  \[アクセス許可\] で、データ接続のアクセス許可を指定します。  
  
     初期化プロパティの詳細については、各 OLE DB プロバイダーに付属のドキュメントを参照してください。  
  
     **すべて**  
     このタブには、データ ソースと接続に対して指定した初期化プロパティの概要が表示されます。  これらの値は編集できます。  
  
     **\[OK\]** をクリックして終了します。  \[データベース オブジェクトの選択\] ダイアログ ボックスが表示されます。  このダイアログ ボックスでは、コンシューマーが使用するテーブル、ビュー、またはストアド プロシージャを選択します。  
  
 `Class`  
 データ ソースを選択すると、このボックスには、選択したテーブルまたはストアド プロシージャに基づいて既定のクラス名が設定されます。下の \[データ ソース\] の説明を参照してください。  このクラス名は編集できます。  
  
 **\[.h ファイル\]**  
 データ ソースを選択すると、このボックスには、選択したテーブルまたはストアド プロシージャに基づいて既定のヘッダー クラス名が設定されます。下の \[データ ソース\] の説明を参照してください。  ヘッダー ファイル名を編集したり、既存のヘッダー ファイルを選択することも可能です。  
  
 **\[属性付き\]**  
 このオプションを選択するかどうかによって、ウィザードがコンシューマー クラスを作成するときに属性とテンプレート宣言のどちらを使用するかが決まります。  このオプションを選択すると、ウィザードはテンプレート宣言ではなく属性を使用します。既定では、このオプションが選択されています。  このオプションを選択しないと、ウィザードは属性の代わりに、テンプレートの宣言子を使用します。  
  
-   コンシューマーの**種類**として \[テーブル\] を選択した場合、ウィザードは `db_source` 属性と **db\_table** 属性を使用して、テーブル クラスの宣言とテーブル アクセサー クラスの宣言を作成し、**db\_column** を使用して、列マップを作成します。次に例を示します。  
  
    ```  
    // Inject table class and table accessor class declarations  
    [  
        db_source("<initialization_string>"),  
        db_table("dbo.Orders")  
    ]  
    ...  
    // Column map  
        [ db_column(1, status=m_dwOrderIDStatus,         length=m_dwOrderIDLength) ] LONG m_OrderID;  
        [ db_column(2, status=m_dwCustomerIDStatus,         length=m_dwCustomerIDLength) ] TCHAR m_CustomerID[6];  
        ...  
    ```  
  
     これは、次のように、`CTable` テンプレート クラスを使用して、テーブル クラスとテーブル アクセサー クラスを宣言し、BEGIN\_COLUMN\_MAP マクロと END\_COLUMN\_MAP マクロを使用して列マップを作成する場合とは異なります。  
  
    ```  
    // Table accessor class  
    class COrdersAccessor;  
    // Table class  
    class COrders : public CTable<CAccessor<COrdersAccessor> >;  
    ...  
    // Column map  
    BEGIN_COLUMN_MAP(COrderDetailsAccessor)  
        COLUMN_ENTRY_LENGTH_STATUS(1, m_OrderID,         m_dwOrderIDLength, m_dwOrderIDStatus)  
        COLUMN_ENTRY_LENGTH_STATUS(2, m_CustomerID,         m_dwCustomerIDLength, m_dwCustomerIDStatus)  
        ...  
    END_COLUMN_MAP()  
    ```  
  
-   コンシューマーの**種類**として \[コマンド\] を選択した場合、ウィザードは `db_source` 属性と **db\_command** 属性を使用し、**db\_column** を使用して、列マップを作成します。次に例を示します。  
  
    ```  
    [  
        db_source("<initialization_string>"),  
        db_command("SQL_command")  
    ]  
    ...  
    // Column map using db_column is the same as for consumer type of 'table'  
    ```  
  
     これは、次のように、コマンド クラスの .h ファイル内のコマンド クラスの宣言とコマンド アクセサー クラスの宣言を使用する場合とは異なります。  
  
    ```  
    Command accessor class:  
    class CListOrdersAccessor;  
    Command class:  
    class CListOrders : public CCommand<CAccessor<CListOrdersAccessor> >;  
    ...  
    // Column map using BEGIN_COLUMN_MAP ... END_COLUMN_MAP is the same as  
    // for consumer type of 'table'  
    ```  
  
 詳細については、「[Basic Mechanics of Attributes](../../windows/basic-mechanics-of-attributes.md)」を参照してください。  
  
 **型**  
 以下のオプション ボタンのいずれかをクリックし、コンシューマー クラスが `CTable` と `CCommand` \(既定\) のどちらから派生するかを指定します。  
  
 **\[テーブル\]\]**  
 `CTable` または **db\_table** を使用してテーブル クラスの宣言とテーブル アクセサー クラスの宣言を作成する場合は、このオプションを選択します。  
  
 **コマンド**  
 `CCommand` または **db\_command** を使用してコマンド クラスの宣言とコマンド アクセサー クラスの宣言を作成する場合は、このオプションを選択します。  これは、既定の設定です。  
  
 **\[サポート\]**  
 コンシューマーでサポートする更新の種類を指定するには、このチェック ボックスをオンにします。既定では、更新はサポートされません。  以下の各オプションでは、プロパティ セット マップに [DBPROP\_IRowsetChange](https://msdn.microsoft.com/en-us/library/ms715892.aspx) と、[DBPROP\_UPDATABILITY](https://msdn.microsoft.com/en-us/library/ms722676.aspx) の適切なエントリが設定されます。  
  
 **\[変更\]**  
 コンシューマーが行セットでの行データの更新をサポートするように指定します。  
  
 **\[挿入\]**  
 コンシューマーが行セットへの行の挿入をサポートするように指定します。  
  
 **削除**  
 コンシューマーが行セットからの行の削除をサポートするように指定します。  
  
## 参照  
 [ATL OLE DB Consumer](../../atl/reference/adding-an-atl-ole-db-consumer.md)   
 [コード ウィザードを使用した機能の追加](../../ide/adding-functionality-with-code-wizards-cpp.md)   
 [Connection Strings and Data Links \(OLE DB\)](https://msdn.microsoft.com/en-us/library/ms718376.aspx)