---
title: "印刷プレビューのアーキテクチャ | Microsoft Docs"
ms.custom: ""
ms.date: "12/03/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "プレビュー (印刷を)"
  - "印刷プレビュー, アーキテクチャ"
  - "印刷プレビュー, 変更 (MFC に対する)"
  - "印刷プレビュー, プロセス"
  - "印刷 [MFC], 印刷プレビュー"
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
caps.latest.revision: 10
caps.handback.revision: 6
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# 印刷プレビューのアーキテクチャ
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

ここでは、MFC フレームワークが印刷プレビュー機能を実装する方法について説明します。  ここでは、次の内容について説明します。  
  
-   [印刷プレビュー プロセス](#_core_the_print_preview_process)  
  
-   [変更の印刷プレビュー](#_core_modifying_print_preview)  
  
 印刷プレビューを直接デバイスのイメージを描画する代わりに、アプリケーションが画面を使用してプリンターをシミュレートする必要があるため、画面表示と印刷と多少異なります。  これを行うには、Microsoft Foundation Class ライブラリには **CPreviewDC**という [CDC クラス](../Topic/CDC%20Class.md)から派生したクラスで、\(非公開のな\) を定義します。  `CDC` のオブジェクトはすべて 2 デバイス コンテキストが含まれていますが、通常は同じです。  **CPreviewDC** オブジェクトでは、これらは異なります。: 1 番目は、モデル化されているプリンターを表し、2 番目の出力が実際に表示される画面を表します。  
  
##  <a name="_core_the_print_preview_process"></a> 印刷プレビュー プロセス  
 ユーザーが印刷プレビュー **ファイル** メニューからコマンドを選択すると、フレームワークは **CPreviewDC** オブジェクトを作成します。  アプリケーションがプリンター デバイス コンテキストの特性を設定する操作を実行すると、フレームワークは、画面デバイス コンテキストのようなアクションを実行します。  たとえば、アプリケーションが印刷にフォントを選択すると、フレームワークはプリンター フォントをシミュレートする画面にフォントを選択します。  アプリケーションがプリンターに出力するたびに、フレームワークは画面に出力を送信します。  
  
 印刷プレビューは、順序で印刷にはそれぞれがドキュメント ページを描画できます。  印刷時に、フレームワークが特定の範囲内のページが印刷されるまでループが継続されます。  印刷プレビュー中に、それらのページは常に表示され、アプリケーションが待機; そのほかのページから応答まで表示されません。  印刷プレビュー中に、アプリケーションには、`WM_PAINT` メッセージに対して通常の画面表示中に実行するように応答する必要があります。  
  
 [CView::OnPreparePrinting](../Topic/CView::OnPreparePrinting.md) 関数は、印刷ジョブの先頭にあるため、プレビュー モードが呼び出されたときに呼び出されます。  関数に渡される [CPrintInfo 構造体](../mfc/reference/cprintinfo-structure.md) 構造体は値の設定、印刷プレビュー操作の特定の特性を変更するために使用できるいくつかのメンバーが含まれています。  たとえば、1 ページまたは 2 ページ モードで文書をプレビューするかどうかを **m\_nNumPreviewPages** のメンバーを設定できます。  
  
##  <a name="_core_modifying_print_preview"></a> 変更の印刷プレビュー  
 さまざまな方法で印刷プレビューの動作と外観を多少簡単に変更できます。  たとえば、特に:できます  
  
-   印刷プレビュー ウィンドウをドキュメント内の任意のページへの簡単なアクセスのスクロール バーを表示するようにつながります。  
  
-   印刷プレビューを現在のページの表示を開き、ドキュメントのユーザーの位置を保持するようにつながります。  
  
-   別の初期化を印刷プレビュー、印刷するために実行します。  
  
-   独自の形式で表示ページ番号を印刷プレビューを発生させます。  
  
 ドキュメントがどの程度あり、適切な値を `SetMaxPage` を呼び出すと、フレームワークは、印刷プレビュー モードでの実行時にこの情報を使用できます。  フレームワークは、ドキュメントの長さがわかっている場合は、スクロール バーがプレビュー ウィンドウに割り当てることができ、プレビュー モード ドキュメントをとおして双方向のページングをユーザーに許可します。  ドキュメントの長さを設定しない場合、フレームワークは現在位置を示すようにスクロール ボックスを配置できないので、フレームワークは、スクロール バーを追加しません。  この場合、ユーザーは文書をページングするためにプレビュー ウィンドウのコントロール バーの次のページ、前のページ ボタンを使用する必要があります。  
  
 印刷プレビュー用に、通常の印刷では実行されません。`CPrintInfo`の `m_nCurPage` メンバーに値を割り当てると便利な場合があります。  通常の出力では、このメンバーはフレームワークからビュー クラスの情報を示します。  これにより、ページが印刷されるかをフレームワークがどのようにビューに指示します。  
  
 一方、印刷プレビュー モードが開始されると、`m_nCurPage` のメンバーは、逆方向に情報を送信: ビューからフレームワークの。  フレームワークは、ページが最初にプレビューするかを判断するには、このメンバーの値を使用します。  このメンバーの既定値は 1 です。したがって、このドキュメントの最初のページが最初に表示されます。  印刷プレビューの各コマンドが呼び出されたときに表示されるページの数は、このメンバーを設定するに `OnPreparePrinting` をオーバーライドできます。  この方法では、アプリケーションの通常の表示モードを印刷プレビュー モードに移行するとき、ユーザーの現在の位置を保持します。  
  
 、印刷ジョブ印刷プレビューに呼び出されるかを `OnPreparePrinting` に別の初期化として追加する必要があります。  `CPrintInfo` 構造体の **m\_bPreview** のメンバー変数を調べることによってこれを確認できます。  このメンバーは **TRUE** に印刷プレビューが呼び出されたときに設定されます。  
  
 `CPrintInfo` 構造体は、**m\_strPageDesc**という名前の単一または複数のページ モードの画面の下部に表示される文字列の書式設定に使用するメンバーが含まれています。  既定ではフォームの文字列「 *n*」ページで、「 *n*のページングします   \-*m*」、が、複雑に `OnPreparePrinting` 内から **m\_strPageDesc** を変更し、要素に文字列を設定できます。  詳細については、" *MFC リファレンス* " の[CPrintInfo 構造体](../mfc/reference/cprintinfo-structure.md) を参照してください。  
  
## 参照  
 [印刷および印刷プレビュー](../mfc/printing-and-print-preview.md)   
 [印刷](../mfc/printing.md)   
 [CView クラス](../Topic/CView%20Class.md)   
 [CDC クラス](../Topic/CDC%20Class.md)