---
title: "テクニカル ノート 40: MFC/OLE 埋め込み先サイズ変更とズーム | Microsoft Docs"
ms.custom: ""
ms.date: "12/03/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vc.mfc.ole"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "埋め込み先編集の有効化, ズームとサイズ変更"
  - "サイズ変更 (埋め込み先の)"
  - "TN040"
  - "ズームと埋め込み先編集の有効化"
ms.assetid: 4d7859bd-0b2e-4254-be62-2735cecf02c6
caps.latest.revision: 10
caps.handback.revision: 6
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# テクニカル ノート 40: MFC/OLE 埋め込み先サイズ変更とズーム
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

> [!NOTE]
>  次のテクニカル ノートは、最初にオンライン ドキュメントの一部とされてから更新されていません。  結果として、一部のプロシージャおよびトピックが最新でないか、不正になります。  最新の情報について、オンライン ドキュメントのキーワードで関係のあるトピックを検索することをお勧めします。  
  
 ここでは埋め込み先での編集に対してサーバーが正しいズームおよび埋め込み先でのサイズ変更を実現する必要のある問題について説明します。  埋め込み先編集の有効化、WYSIWYG の概念はコンテナーとサーバーが互いに連携して動作する踏まれ特に、OLE 固有とほぼ同様に解釈されることを applyIt。  
  
 コンテナーとサーバー サポートの埋め込み先編集の有効化の間の対話に保持する必要があるエンド ユーザーから一部の要求があります:  
  
-   描画時にプレゼンテーションの表示 \(`COleServerItem::OnDraw` のオーバーライドで描画されたメタファイル\) \(編集が、表示されないとまったく同じになります。編集\) ツールが対象です。  
  
-   コンテナーが拡大すると、サーバー ウィンドウはが必要です。  
  
-   コンテナーとサーバーの両方を同じ測度を使用して編集するオブジェクトが表示されます。  この 1 インチあたり *論理* ピクセル—ディスプレイ デバイスにする場合は 1 インチあたり物理的ではないピクセルの数に基づいてマップ モードを使用していることを意味します。  
  
> [!NOTE]
>  埋め込み先編集の有効化 \(リンクされて埋め込まれた\) 項目にのみ適用されるので、拡大と埋め込みオブジェクトにのみ適用されます。  縮小に使用する `COleServerItem`、両方の `COleServerDoc` API を参照します。  この二分法の理由は、リンクされた用に有効で埋め込まれたアイテムのみ `COleServerItem` \(これに共通の実装があることを許可します\)、関数と埋め込みオブジェクトのみ有効である関数は `COleServerDoc` クラスです \(サーバーの観点からは、埋め込まれた\) は `document` です。  
  
 負担のほとんどはサーバー実装にサーバーがコンテナーのズーム ファクターを認識し、必要に応じて編集インターフェイスを変更する必要があります。配置されます。  ただし、サーバーがどのようにコンテナーを使用するズーム ファクターを決定します。  
  
## ズームのサポート  
 現在のズーム ファクターは `COleServerDoc::GetZoomFactor`を呼び出すことによって確認できます。  ドキュメントが埋め込み先編集が有効な場合にこれを呼び出すと、100% のズーム ファクター常に改善されます \(または 1:1 の比率\)。  埋め込み先編集が 100% 以外の値を返す場合もありますが、それを呼び出す。  
  
 正しく拡大する例については、OLE [HIERSVR](../top/visual-cpp-samples.md)MFC サンプルを参照してください。  HIERSVR のズーム インでテキストを表示する、テキストは通常、線上にスケーリングするとは限らないため、複雑になり \(ヒント、印刷、デザイン上の取り決め Width と Height はすべて関係が複雑になります。  さらに、HIERSVR は正しくズームを実装するための適切な参照であるため、MFC チュートリアルの [Scribble](../top/visual-cpp-samples.md) \(手順 7\) です。  
  
 `COleServerDoc::GetZoomFactor` は コンテナーまたは `COleServerItem` と `COleServerDoc` クラスの実装から使用できる多数の別の測度に基づいてズーム ファクターを決定します。  つまり、現在のズーム ファクターは次の式によって決まります:  
  
```  
Position Rectangle (PR) / Container Extent (CE)  
```  
  
 四角形の位置は、コンテナーによって決まります。  これは、埋め込み先編集の有効化時にコンテナーとサーバーの `COleServerDoc::OnSetItemRects` を呼び出すと `COleClientItem::OnGetItemPosition` が呼び出されるときに戻り、更新されます \(`COleClientItem::SetItemRects`の呼び出しと\)。  
  
 コンテナーのエクステントは計算に多少複雑です。  コンテナーが `COleServerItem::OnSetExtent` \(`COleClientItem::SetExtent`の呼び出しと\) 場合、コンテナーのエクステントは 1 論理インチ ピクセルあたりの数に基づいてピクセルに変換されるこの値です。  コンテナーが \(通常はそうである SetExtent 呼び出さなかった場合、コンテナーの範囲は `COleServerItem::OnGetExtent`から返されるサイズです。  このコンテナーが SetExtent を呼び出さなかった場合、フレームワークはするコンテナーは通常のエクステント \(**COleServerItem::GetExtent**から返される値\) の 100% を呼出そうと仮定します。  コンテナーが項目の 100% \(これ以上、あまり\) 表示する別の方法と、フレームワークを前提について説明しました。  
  
 `COleServerItem::OnSetExtent` と `COleServerItem::OnGetExtent` に似た名前がありますが、これらは同じ項目の属性を操作しないように注意する必要があります。  `OnSetExtent` は サーバーに \(ズーム ファクター\) に関係なくコンテナーに表示され、オブジェクトの量を知らせるために、オブジェクトの適切なサイズを決定するために `OnGetExtent` はコンテナーによって呼び出されます。  
  
 含める API に表示して明確に把握することができますが、T:  
  
## COleServerItem::OnGetExtent  
 この関数は、項目の HIMETRIC 単位の「自然なサイズ」を返します。  「自然なサイズについては」、最善の方法は、使用できるサイズとして定義します。印刷時。  次に返されるサイズは特定の項目の内容に定数です \(特定の項目に対して設定するメタファイル\) のようになります。  このサイズは拡大が項目に適用されたときに変更されません。  通常は、コンテナーが `OnSetExtent`を呼び出すことにより、その項目に多くまたは縮小領域を与えると変わりません。  変更には、コンテナーによって送信された最後の範囲に基づいてテキストをラップした「余白」機能を持たない簡易テキスト エディターの ID である場合があります。  サーバーが変更されると、サーバーは、システム レジストリの OLEMISC\_RECOMPOSEONRESIZE ビットを設定する必要があります \(このオプションの詳細については、" OLE SDK のドキュメントを参照してください。  
  
## COleServerItem::OnSetExtent  
 この関数は、コンテナーがオブジェクトの「量が示すかれ」と呼ばれます。  ほとんどのコンテナーでは、これは呼び出されません。  既定の実装では、上記のコンテナーの範囲の値を計算するときに `COleServerDoc::GetZoomFactor` で使用される「m\_sizeExtent」でコンテナーから受け取った最後の値を格納します。  
  
## COleServerDoc::OnSetItemRects  
 この関数は、ドキュメントが埋め込み先編集が有効な場合にのみ呼び出されます。  これは、コンテナーが項目に適用された項目の位置またはクリッピングを更新するときに呼び出されます。  上で説明したように、位置の四角形は、ズーム ファクターを計算する、分子を提供します。  サーバーは項目の位置が `COleServerDoc::RequestPositionChange`を呼び出して、変更するように要求できます。  コンテナーは、この要求に `OnSetItemRects` を呼び出して応答しない場合もあれば、null で終わらない場合があります \(**COleServerItem::SetItemRects**の呼び出しと\)。  
  
## COleServerDoc::OnDraw  
 `COleServerItem::OnDraw` のオーバーライドによって作成されたメタファイルも同じメタファイルを使用するには、現在のズーム ファクターに関係なくことを理解することが重要です。  コンテナーを適切にメタファイルをスケーリングします。  これは、ビューの `OnDraw` とサーバー項目の `OnDraw`間の相違点です。  ビューには、ズームを処理しますが、項目コンテナーまで、*zoomable* 適切なズームを行うために、リーフ メタファイルを作成します。  
  
 サーバーが正しく動作することを保証する最良の方法は、ドキュメントが埋め込み先編集の場合 `COleServerDoc::GetZoomFactor` の実装を使用することです。  
  
## 埋め込み先でのサイズ変更のサポート  
 MFC ライブラリには、OLE 2 仕様に記述されているように埋め込み先でのサイズ変更インターフェイスを実装します。  ユーザーは `COleResizeBar` クラス、カスタム メッセージ **WM\_SIZECHILD**、`COleIPFrameWnd`でこのメッセージの特殊な処理でサポートされます。  
  
 が提供するフレームワークによって、このメッセージの処理を実装したい場合があります。  前に述べたように、フレームワークはコンテナーまで埋め込み先でのサイズ変更の結果が大きく—サーバーはズーム ファクターで変更に応答します。  コンテナーが true に設定 `COleClientItem::OnChangeItemPosition` 反応する場合の処理中のコンテナーの両方の範囲と位置の四角形は \(`COleServerDoc::RequestPositionChange`の呼び出しの結果として呼び出される\) 表示には、埋め込みサイズ変更する編集ウィンドウの項目の「量がかれ」となります。  コンテナーは、`COleClientItem::OnChangeItemPosition`の処理中に四角形の位置を設定することによって、対応すると、ズーム ファクターが変更され、項目については、「または」拡大します。  
  
 サーバーはの動作がこのネゴシエート中に制御できます \(角度に\)。  スプレッドシートなどは、埋め込み先アイテムを編集しているときに、ユーザーがウィンドウのサイズを変更すると、以内のセルを表示するように選択する場合があります。  ワードプロセッサは「ページ」余白を変更するように選択の可能性があるので、新しい余白にウィンドウと rewrap と同じテキストです。  サーバーは通常のエクステント \(`COleServerItem::OnGetExtent`から返されるサイズ\) を変更することによってサイズ変更が発生したときにこれを実装します。  これにより、同じズーム ファクターにより、変更の量に位置の四角形とコンテナーの範囲を超える場合、または表示領域の両方が発生します。  また、ドキュメントの量がかれ `OnDraw`で生成されたメタファイルに表示されます。  この場合、ユーザーが列のサイズを変更すると、ドキュメント自体は、表示領域の代わりに変更します。  
  
 カスタムのサイズ変更はまだ実装し、`COleIPFrameWnd` クラスの **WM\_SIZECHILD** メッセージをオーバーライドして `COleResizeBar` によって提供されるユーザー インターフェイスを使用できます。  **WM\_SIZECHILD**の固有の詳細については、「[テクニカル ノート 24](../mfc/tn024-mfc-defined-messages-and-resources.md)」を参照してください。  
  
## 参照  
 [番号順テクニカル ノート](../mfc/technical-notes-by-number.md)   
 [カテゴリ別テクニカル ノート](../mfc/technical-notes-by-category.md)