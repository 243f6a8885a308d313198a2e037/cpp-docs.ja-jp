---
title: "移植のガイド: MFC Scribble | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
ms.assetid: 8ddb517d-89ba-41a1-ab0d-4d2c6d9047e8
caps.latest.revision: 5
caps.handback.revision: 3
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# 移植のガイド: MFC Scribble
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

このトピックは、古いバージョンの Visual Studio で作成された Visual C\+\+ プロジェクトを [!INCLUDE[cpp_dev14_long](../porting/includes/cpp_dev14_long_md.md)] にアップグレードする手順を紹介する複数のトピックの 1 つ目です。  これらのトピックでは、例によってアップグレード プロセスを照会し、とてもシンプルなプロジェクトから始めて、少し複雑なものに進みます。  このトピックでは、特定のプロジェクト \(MFC Scribble\) についてのアップグレード プロセスの作業を行います。  これは、C\+\+ プロジェクトのアップグレード プロセスに関する基本的な紹介として適しています。  
  
 各バージョンの Visual Studio には、古いバージョンの Visual Studio から新しいバージョンへの移動を複雑にする可能性のある、非互換性が持ち込まれることがあります。  必要な変更がコード内にあり、コードを再コンパイルして更新しなければならないことがあり、必要な変更がプロジェクト ファイル内にあることもあります。  以前のバージョンの Visual Studio で作成されたプロジェクトを開くと、Visual Studio によりプロジェクトまたはソリューションを最新バージョンに更新するかどうかが自動的に確認されます。  これらのツールは通常、プロジェクト ファイルのみをアップグレードします。これらは、ソース コードは変更しません。  
  
## MFC Scribble  
 MFC Scribble は、多くの異なるリリースの Visual C\+\+ に含まれている、よく知られているサンプルです。  これは、MFC の基本的な機能の一部を示す、簡単な描画アプリケーションです。  様々なバージョンを利用でき、マネージ コードとネイティブ コードの両方のバージョンがあります。  この例では、Scribble の旧バージョンが Visual Studio 2005 からのネイティブ コードで見つかり、[!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)] で開いています。  
  
 アップグレードを試行する前に、ソリューション全体とすべてのコンテンツをバックアップします。  次に、アップグレードの特定の方式を決定する必要があります。  長期間アップグレードされていない、さらに複雑なソリューションとプロジェクトについては、一度に 1 つのバージョンの Visual Studio のアップグレードを検討してください。  これにより、Visual Studio のどのバージョンで問題が発生したのか絞り込むことができます。  単純なプロジェクトについては、最新のバージョンの Visual Studio で開こうとすると、ウィザードでプロジェクトを変換することができます。  うまくいかない場合には、適切なバージョンの Visual Studio にアクセスできるなら、一度に 1 つのバージョンをアップグレードすることができます。  
  
 また、ウィザードを使用してプロジェクトをアップグレードする代わりに、コマンドラインで `/Upgrade` オプションを使用して devenv を実行できることに注意してください。  「[\/Upgrade](../Topic/-Upgrade%20\(devenv.exe\).md)」を参照してください。  これは、多数のプロジェクトのアップグレード プロセスを自動化するのに役に立ちます。  
  
### 手順 1.プロジェクト ファイルを変換する  
 Visual Studio 2015 で古いプロジェクト ファイルを開くと、Visual Studio がプロジェクト ファイルの最新バージョンへの変換を提供するので、受け入れます。  次のダイアログ ボックスが表示されました。  
  
 ![プロジェクトとソリューションの変更をレビュー](../porting/media/scribbleprojectupgrade.png "ScribbleProjectUpgrade")  
  
 Itanium のターゲットは使用できず、変換されないことを通知するエラーが発生しました。  
  
  **プラットフォーム 'Itanium' がこのプロジェクトにありません。  このプラットフォームに固有のすべての構成とファイル構成設定は無視されます。  このプラットフォームを変換するには、対応するプラットフォームが '%vctargetpath%\\platforms\\Itanium' にインストールされていることを確認してください。  このプラットフォームを使用せずにこのプロジェクトの変換を続行しますか?**  前の Scribble プロジェクトの作成時、Itanium は重要なターゲット プラットフォームでした。  Windows プラットフォームは Itanium をサポートしなくなったので、Itanium プラットフォームをサポートせずに続行するように選択しました。  
  
 Visual Studio で、古いプロジェクト ファイルのすべての問題を一覧表示する、移行レポートが表示されました。  
  
 ![レポートのアップグレード](../porting/media/scribblemigrationreport.png "ScribbleMigrationReport")  
  
 ここでは、問題がすべて警告であり、Visual Studio がプロジェクト ファイルで適切な変更を行いました。  プロジェクトに関する大きな違いは、ビルド ツールが vcbuild から msbuild に変更されたことです。  この変更は、Visual Studio 2010 で初めて導入されました。  その他の変更点として、プロジェクト ファイル自体にいくつかの要素のシーケンスの再配列が含まれます。  このシンプルなプロジェクトについて、これ以上注意が必要な問題はありません。  
  
### 手順 2.ビルドできる状態にする  
 ビルド前に、プロジェクト システムがどのコンパイラのバージョンを使用しているのかを知るため、プラットフォーム ツールセットを確認します。  \[プロジェクトのプロパティ\] ダイアログの **\[構成プロパティ\]** にある **\[全般\]** カテゴリで、**\[プラットフォーム ツールセット\]** プロパティを確認します。  それには、Visual Studio のバージョンとプラットフォームのツールのバージョン番号が含まれ、このケースではツールの [!INCLUDE[cpp_dev14_long](../porting/includes/cpp_dev14_long_md.md)] のバージョンは v140 です。  もともと Visual C\+\+ 2010、2012、または 2013 を使用してコンパイルされているプロジェクトを変換する場合、ツールセットは [!INCLUDE[cpp_dev14_long](../porting/includes/cpp_dev14_long_md.md)] ツールセットに自動的に更新されません。  Scribble の場合は、変換したバージョンが Visual Studio 2005 用に作成されているため、最新のツールセットを使用するよう変換されます。  
  
 ビルドの際に現れる最初の問題は、MBCS コードに関するものです。  
  
  **エラー MSB8031:**  エラー メッセージ内のリンクでは、Visual Studio 2013 での MBCS の非推奨についてのトピックに移動します。  既定では、Visual C\+\+ 2013 の MFC のインストールには、MFC の MBCS バージョンは含まれていません。  現在の形式で、このプロジェクトをビルドするには、MFC の MBCS バージョンが必要です。  Unicode を使用するようコードを移行するか、MFC バージョンの MBCS をダウンロードしてインストールできます。  MFC の MBCS バージョンのダウンロードを行う場合、この警告を抑制するために NO\_WARN\_MBCS\_MFC\_DEPRECATION のマクロの定義を追加できます。  
  
 MFC の MBCS バージョンをダウンロードするには、最初に記事「[MFC MBCS DLL アドオン](../mfc/mfc-mbcs-dll-add-on.md)」の MFC の MBCS バージョンの非推奨について読み、VC のブログの[こちら](http://www.microsoft.com/download/details.aspx?id=44930)で MFC バージョンの MBCS をダウンロードします。  \[プロジェクトのプロパティ\] ダイアログ ボックスの **\[C\/C\+\+\]** カテゴリにある **\[プリプロセッサ\]** で、NO\_WARN\_MBCS\_MFC\_DEPRECATION を事前定義のマクロの一覧に追加します。  
  
 Unicode に切り替えるには、プロジェクトのプロパティを開き、**\[構成プロパティ\]** で**\[全般\]** セクションを選択して、**\[文字セット\]** プロパティを探します。  これを **\[マルチ バイト文字セットを使用する\]** から **\[Unicode 文字セットを使用する\]** に変更します。  この変更の影響として、\_UNICODE と UNICODE のマクロが定義されて、\_MBCS が定義されなくなります。このことは、**\[コマンド ライン\]** プロパティの **\[C\/C\+\+\]** カテゴリで確認できます。  
  
  **\/GS \/analyze\- \/W4 \/Gy \/Zc:wchar\_t \/Zi \/Gm\- \/O2 \/Ob1 \/Fd".  \\Release\\vc140.pdb" \/Zc:inline \/fp:precise \/D "\_AFXDLL" \/D "WIN32" \/D "NDEBUG" \/D "\_WINDOWS" \/D "\_UNICODE" \/D "UNICODE" \/errorReport:prompt \/GF \/WX \/Zc:forScope \/Gd \/Oy \/MD \/Fa".  \\Release\\" \/EHsc \/nologo \/Fo".  \\Release\\" \/Fp".  \\Release\\Scribble.pch"**  Scribble プロジェクトは Unicode 文字を使用してコンパイルするように設定されていませんでしたが、既に char の代わりに TCHAR を使用して作成されているので、実際には何も変更する必要がありません。  Unicode 文字セットを使用して、プロジェクトが正常にビルドされます。  
  
 ただし、別の問題があります。  コンパイラによって \_WINNT32\_WINNT が定義されていないことが通知されます。  
  
  **\_WIN32\_WINNT not defined.  Defaulting to \_WIN32\_WINNT\_MAXVER \(see WinSDKVer.h\)**  これは、エラーではなく警告であり、Visual C\+\+ プロジェクトをアップグレードするときに、ごく一般的に見られます。  これは、アプリケーションが動作する Windows の最も低いバージョンを定義するマクロです。  警告を無視する場合は、現在のバージョンの Windows という意味である、既定値の \_WIN32\_WINNT\_MAXVER をそのまま使用します。  有効な値の一覧は、「[Windows のヘッダーを使用する](https://msdn.microsoft.com/ja-jp/library/aa383745.aspx)」を参照してください。  たとえば、Vista 以降のすべてのバージョンで動作するよう設定できます。  
  
```  
#define _WIN32_WINNT _WIN32_WINNT_VISTA  
```  
  
 このマクロで指定する Windows のバージョンで利用できない Windows API のパーツをコードが使用している場合には、コンパイラ エラーとして表示されます。  Scribble コードの場合は、エラーはありません。  
  
### 手順 3.テストおよびデバッグを行う  
 テスト スイートはないため、アプリを起動して、UI から手動で機能をテストしました。  問題は検出されませんでした。  
  
### 手順 4.レイアウトを改良する  
 Visual Studio 2015 に移行したので、C\+\+ の新機能を活用するためにいくつかの変更を加えたいと思います。  現在のバージョンの Visual C\+\+ コンパイラは、以前のバージョンよりも C\+\+ への適合性が向上しているので、コードの安全性を高めるためにコードを変更し、ほかのコンパイラやオペレーティング システムへの移植性を高めたい場合には、幾らかの改良を加えることを検討してください。  
  
## 次の手順  
 Scribble は小規模で単純な Windows デスクトップ アプリケーションであり、変換は難しくありません。  多くの小規模で単純なアプリケーションは、新しいバージョンに簡単に変換できます。  コードの行数が多く、エンジニアリングの最新の標準になっていない可能性がある古いレガシー コードや、複数のプロジェクトとライブラリ、カスタム ビルド アプリを持つ複雑なアプリケーションや、複雑なスクリプトを作成して自動化されていビルドでは、アップグレードにもう少し時間がかかります。  [次の例](../porting/porting-guide-com-spy.md)の COM Spy と呼ばれる ATL\/COM アプリケーションに進みます。  
  
## 参照  
 [移植およびアップグレード: 例とケース スタディ](../porting/porting-and-upgrading-examples-and-case-studies.md)   
 [次の例: COM Spy](../porting/porting-guide-com-spy.md)