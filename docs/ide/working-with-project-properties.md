---
title: プロジェクトのプロパティの操作
ms.date: 08/27/2018
helpviewer_keywords:
- project properties [C++], modifying
- properties [C++]
- Visual C++ projects, properties
- projects [C++], properties
ms.assetid: 9b0d6f8b-7d4e-4e61-aa75-7d14944816cd
ms.openlocfilehash: 5edf7a9a162c0980a6d872658204bcdf66fbdb7e
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/31/2018
ms.locfileid: "50516286"
---
# <a name="working-with-project-properties"></a>プロジェクトのプロパティの操作

IDE では、プロジェクトをビルドするために必要なすべての情報は "*プロパティ*" として公開されます。 この情報には、アプリケーションの名前、拡張子 (DLL、LIB、EXE)、コンパイラ オプション、リンカー オプション、デバッガーの設定、カスタム ビルド ステップ、その他多くの情報が含まれます。 通常、これらのプロパティを表示および変更するには、"*プロパティ ページ*" (**[プロジェクト] > [プロパティ]**) を使います。

プロジェクトを作成すると、システムによってさまざまなプロパティの値が割り当てられます。 プロジェクトの種類およびアプリ ウィザードで選んだオプションにより、既定値は若干異なります。 たとえば、ATL プロジェクトには MIDL ファイルに関するプロパティがありますが、基本的なコンソール アプリケーションにはありません。 既定のプロパティは、プロパティ ページの [全般] ウィンドウに表示されます。

![Visual C&#43;&#43; プロジェクトの既定値](../ide/media/visual-c---project-defaults.png "Visual C++ プロジェクトの既定値")

アプリケーション名などの一部のプロパティは、ターゲット プラットフォームが何か、またはデバッグ ビルドかリリース ビルドかに関係なく、ビルドのすべてのバリエーションに適用されます。 ただし、ほとんどのプロパティは構成に依存します。 これは、コンパイラは、プログラムが実行される特定のプラットフォームと、正しいコードを生成するために使う特定のコンパイラ オプションを、知る必要があるためです。 そのため、プロパティを設定するときは、新しい値を適用する必要がある構成とプラットフォームに注意を払う必要があります。 "デバッグ Win32" ビルドだけに適用する必要がありますか、それとも "デバッグ ARM" と "デバッグ x64" にも適用する必要がありますか。 たとえば、既定の **[最適化]** プロパティは、リリース構成では **[実行速度 (/O2)]** に設定されますが、デバッグ構成では無効になっています。

プロパティ ページは、常に見ることができ、必要に応じて、プロパティ値を適用する必要がある構成とプラットフォームを変更できるように設計されています。 次の図のプロパティ ページでは、上部のリスト ボックスに構成とプラットフォームの情報が示されています。 ここで **[最適化]** プロパティを設定すると、設定は "デバッグ Win32" ビルドだけに適用されます。赤い矢印で示されているように、それはアクティブな構成です。

![アクティブな構成が示されている Visual C&#43;&#43; のプロパティ ページ](../ide/media/visual-c---property-pages-showing-active-configuration.png "アクティブな構成が示されている Visual C++ のプロパティ ページ")

次の図も同じプロジェクトのプロパティ ページですが、構成がリリースに変更されています。 [最適化] プロパティの値が異なることに注意してください。 また、アクティブな構成はまだデバッグであることにも注意してください。 ここでは、任意の構成のプロパティを設定することができます。アクティブである必要はありません。

![リリース構成が示されている Visual C&#43;&#43; のプロパティ ページ](../ide/media/visual-c---property-pages-showing-release-config.png "リリース構成が示されている Visual++ のプロパティ ページ")

プロジェクト システム自体は MSBuild に基づいており、MSBuild ではファイルの形式と、任意の種類のプロジェクトをビルドするためのルールが定義されています。 MSBuild は、複数の構成とプラットフォームに対するビルドの複雑さの大部分を管理しますが、そのしくみについて少し理解しておく必要があります。 これは、カスタム構成を定義する場合、または複数のプロジェクトで共有してインポートできる再利用可能なプロパティのセットを作成する場合に、特に重要です。

プロジェクトのプロパティは、プロジェクト ファイル (*.vcxproj) に直接格納されるか、またはプロジェクト ファイルによってインポートされる他の .xml または .props ファイルに格納されて、既定値を提供します。 前に示したように、同じ構成の同じプロパティに対し、異なるファイルで異なる値を割り当てることができます。 プロジェクトをビルドするとき、MSBuild エンジンは、プロジェクト ファイルとすべてのインポートされたファイルを、適切に定義された順序 (後述) で評価します。 各ファイルが評価されると、そのファイルで定義されているすべてのプロパティ値が、既存の値をオーバーライドします。 指定されていない値は、前に評価されたファイルから継承されます。 そのため、プロパティ ページでプロパティを設定するときは、それを設定する場所にも注意を払うことが重要です。 あるプロパティを .props ファイルで "X" に設定しても、プロジェクト ファイルでそのプロパティが "Y" に設定されている場合、プロジェクトは "Y" に設定されたプロパティでビルドされます。 同じプロパティが .cpp ファイルなどのプロジェクト項目で "Z" に設定されている場合、MSBuild エンジンは値 "Z" を使います。 詳しくは、後の「[プロパティの継承](#bkmkPropertyInheritance)」をご覧ください。

## <a name="build-configurations"></a>ビルドの構成

構成は、名前が与えられたプロパティの任意のグループでしかありません。 Visual Studio では、デバッグ構成とリリース構成が提供されており、それぞれにおいてデバッグ ビルドまたはリリース ビルドに適したさまざまなプロパティが設定されています。 **構成マネージャー**を使うと、特定のビルド フレーバーに対するプロパティをグループ化するための便利な方法として、カスタム構成を定義できます。 プロパティ マネージャーは、プロパティに関する高度な作業のために使われますが、プロパティの構成を視覚化するのに役立つためここで説明します。 プロパティ マネージャーにアクセスするには、設定に応じて、**[表示] > [プロパティ マネージャー]** または **[表示] > [その他のウィンドウ] > [プロパティ マネージャー]** を選びます。 プロジェクトの構成とプラットフォームのペアごとにノードがあります。 これらの各ノードの下には、その構成に固有のプロパティを設定するプロパティ シート (.props ファイル) のノードがあります。

![プロパティ マネージャー](../ide/media/property-manager.png "プロパティ マネージャー")

プロパティ ページの [全般] ウィンドウ (上図参照) に移動し、[文字セット] プロパティを [Use Unicode]\(Unicode を使用\) ではなく [設定なし] に設定して、**[OK]** をクリックすると、プロパティ マネージャーでは現在の構成に対して **[Unicode Support]\(Unicode のサポート\)** プロパティ シートが表示されなくなりますが、他の構成のためにプロパティ シートは残っています。

プロパティ マネージャーやとプロパティ シートについて詳しくは、後の「[再利用可能なプロパティ構成の作成](#bkmkPropertySheets)」をご覧ください。

> [!TIP]
> .user ファイルはレガシ機能であり、構成/プラットフォームに従ってプロパティが正しくグループ化されるように、削除することをお勧めします。

## <a name="target-platforms"></a>ターゲット プラットフォーム

"*ターゲット プラットフォーム*" とは、実行可能ファイルが実行されるデバイスとオペレーティング システムの種類のことです。 複数のプラットフォームを対象としてプロジェクトをビルドすることができます。 C++ プロジェクトで使用可能なターゲット プラットフォームは、プロジェクトの種類によって異なります。Win32、x64、ARM、Android、iOS などが含まれますが、これらだけではありません。     **構成マネージャー**で表示される **x86** ターゲット プラットフォームは、ネイティブ C++ プロジェクトの **Win32** と同じです。 Win32 とは 32 ビットの Windows を意味し、**x64** は 64 ビットの Windows を意味します。 これら 2 つのプラットフォームについて詳しくは、「[32 ビット アプリケーションの実行](/windows/desktop/WinProg64/running-32-bit-applications)」をご覧ください。

**構成マネージャー**に表示されるターゲット プラットフォームの値 **[任意の CPU]** は、ネイティブ C++ プロジェクトには影響を与えません。これは、C++/CLI および他の .NET プロジェクトの種類に関係がある値です。 詳細については、「[/CLRIMAGETYPE (CLR イメージのタイプの指定)](../build/reference/clrimagetype-specify-type-of-clr-image.md)」を参照してください。

## <a name="property-pages"></a>プロパティ ページ

前述のように、Visual C++ のプロジェクト システムは [MSBuild](/visualstudio/msbuild/msbuild-properties) が基になっており、値は XML のプロジェクト ファイル (既定は .props ファイルと .targets ファイル) に格納されます。 Visual Studio 2015 では、これらのファイルは **\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140** にあります。 Visual Studio 2017 では、これらのファイルは **\\Program Files (x86)\\Microsoft Visual Studio\\2017\\_edition_\\Common7\\IDE\\VC\\VCTargets** にあります。_edition_ はインストールされている Visual Studio のエディションです。 プロパティは、独自のプロジェクトに追加されているすべてのカスタム .props ファイルにも格納されます。 これらのファイルは手動で編集しないことを強くお勧めします。MSBuild を非常によく理解しているのでないかぎり、すべてのプロパティの変更には IDE のプロパティ ページを使ってください。継承に関わるプロパティは特にそうです。

次の図は、Visual C++ プロジェクトのプロパティ ページを示しています。 左側のウィンドウでは **[VC++ ディレクトリ]** *ルール* が選択され、右側のウィンドウには、そのルールに関連付けられているプロパティの一覧が表示されています。 `$(...)` という値は、遺憾ながら "*マクロ*" と呼ばれています。 これらは C/C++ のマクロ "*ではなく*"、単にコンパイル時の定数です。 マクロについては、後の「[プロパティ ページのマクロ](#bkmkPropertiesVersusMacros)」で説明します。

![プロジェクトのプロパティ ページ](../ide/media/project_property_pages_vc.png "Project_Property_Pages_VC")

> [!WARNING]
> Visual Studio の旧バージョンにあった **[共通プロパティ]** という構成は、削除されています。 プロジェクトに参照を追加するには、マネージド言語と同じように **[参照の追加]** ダイアログを使うようになっています。 「[プロジェクト内の参照の管理](/visualstudio/ide/managing-references-in-a-project)」をご覧ください。

#### <a name="to-set-a-property-for-a-project"></a>プロジェクトのプロパティを設定するには

1. ほとんどのシナリオでは、カスタム プロパティ シートを作成することなく、プロジェクト レベルでプロパティを設定できます。 メイン メニューで **[プロジェクト] > [プロパティ]** を選ぶか、**ソリューション エクスプローラー**でプロジェクト ノードを右クリックし、**[プロパティ]** を選びます。

2. ダイアログ ボックスの上部にある **[構成]** と **[プラットフォーム]** の一覧を使って、変更を適用するプロパティ グループを指定します。 多くの場合、**[すべてのプラットフォーム]** と **[すべての構成]** が正しい選択です。 一部の構成についてだけプロパティを設定するには、**プロパティ マネージャー**でそれらを複数選択し、ショートカット メニューを開いて、**[プロパティ]** を選びます。

**[プロパティ ページ]** ダイアログ ボックスには、現在のプロジェクトに適用するプロパティ ページのみが表示されます。 たとえば、プロジェクトに .idl ファイルが含まれていない場合、MIDL プロパティ ページは表示されません。

プロパティ ページでプロパティを強調表示にして **F1** キーを押すと、対応するコンパイラ スイッチまたはリンカー スイッチの詳細についてのリファレンス トピックに移動できます。

各プロパティ ページについて詳しくは、以下のトピックをご覧ください。

- [[全般] プロパティ ページ (プロジェクト)](../ide/general-property-page-project.md)

- [[全般] プロパティ ページ (ファイル)](../ide/general-property-page-file.md)

- [[コマンド ライン] プロパティ ページ](../ide/command-line-property-pages.md)

- [C++ デバッグ構成のプロジェクト設定](/visualstudio/debugger/project-settings-for-a-cpp-debug-configuration)

- [NMake プロパティ ページ](../ide/nmake-property-page.md)

- [[リンカー] プロパティ ページ](../ide/linker-property-pages.md)

- [[リソース] プロパティ ページ](../ide/resources-property-pages.md)

- [[MIDL] プロパティ ページ](../ide/midl-property-pages.md)

- [[Web 参照] プロパティ ページ](../ide/web-references-property-page.md)

- [[XML データ ジェネレーター ツール] プロパティ ページ](../ide/xml-data-generator-tool-property-page.md)

## <a name="to-quickly-browse-and-search-all-properties"></a>すべてのプロパティをすばやく参照および検索するには

**[すべてのオプション]** プロパティ ページ (**[プロパティ ページ]** ダイアログ ボックスの **[構成プロパティ] > [C/C++]** ノードの下) には、現在のコンテキストで使用できるプロパティを簡単に参照および検索する方法が用意されています。 これには特別な検索ボックスと単純な構文が用意されており、結果をフィルター処理できます。

プレフィックスなし:<br/>
プロパティ名のみで検索 (大文字と小文字を区別しない部分文字列)。

'/' または '-' :<br/>
コンパイラ スイッチのみで検索 (大文字と小文字を区別しないプレフィックス)。

v:<br/>
値のみで検索 (大文字と小文字を区別しない部分文字列)。

##  <a name="bkmkPropertiesVersusMacros"></a> プロパティ ページのマクロ

"*マクロ*" とは、Visual Studio や MSBuild システムによって定義されている値またはユーザー定義の値を参照できるコンパイル時定数です。 ディレクトリ パスなどのハードコーディングされた値の代わりにマクロを使用することで、コンピューター間や Visual Studio のバージョン間でより簡単にプロパティ設定を共有でき、プロジェクト設定がプロパティ継承に適切に参加できるようにします。 プロパティ エディターを使って、すべての使用可能なマクロの値を見ることができます。

### <a name="predefined-macros"></a>定義済みマクロ

*グローバル マクロ*<br/>
プロジェクト構成のすべての項目に適用されます。 `$(name)` の構文を持ちます。 Visual Studio インストールのルート ディレクトリを格納するグローバル マクロの例は `$(VCInstallDir)` です。 グローバル マクロは、MSBuild の `PropertyGroup` に対応します。

*項目マクロ*<br/>
`%(name)` の構文を持ちます。 ファイルの場合、項目マクロはそのファイルのみに適用されます。たとえば、`%(AdditionalIncludeDirectories)` を使用して、特定のファイルだけに適用するインクルード ディレクトリを指定します。 この種類の項目マクロは、MSBuild の `ItemGroup` のメタデータに対応します。 プロジェクト構成のコンテキストで使用される場合、項目マクロは、特定の種類のすべてのファイルに適用されます。 たとえば、C/C++ の **[プリプロセッサの定義]** 構成プロパティは、プロジェクトのすべての .cpp ファイルに適用する `%(PreprocessorDefinitions)` 項目マクロを使用できます。 この種類の項目マクロは、MSBuild の `ItemDefinitionGroup` のメタデータに対応します。 詳細については、「[項目定義](/visualstudio/msbuild/item-definitions)」を参照してください。

### <a name="user-defined-macros"></a>ユーザー定義マクロ

プロジェクトのビルドで変数として使う "*ユーザー定義マクロ*" を作成できます。 たとえば、ユーザー定義のマクロを作成して、カスタム ビルド ステップまたはカスタム ビルド ツールに値を渡すことができます。 ユーザー定義マクロは、名前と値のペアです。 プロジェクト ファイル内では、**$(**<em>name</em>**)** という表記を使って、その値にアクセスします。

ユーザー定義マクロは、プロパティ シートに格納されます。 プロジェクトにプロパティ シートが含まれていない場合は、「[再利用可能なプロパティ構成の作成](#bkmkPropertySheets)」の手順に従って作成できます。

##### <a name="to-create-a-user-defined-macro"></a>ユーザー定義マクロを作成するには

1. **[プロパティ マネージャー]** ウィンドウ (メニュー バーで **[表示]**、**[プロパティ マネージャー]** の順に選択) で、プロパティ シート (名前の末尾が .user) のショートカット メニューを開き、プロパティを選びます。 そのプロパティ シートの **[プロパティ ページ]** ダイアログ ボックスが開きます。

1. ダイアログ ボックスの左ウィンドウで、**[ユーザー マクロ]** を選びます。 右ウィンドウで **[マクロの追加]** ボタンを選んで、**[ユーザー マクロの追加]** ダイアログ ボックスを開きます。

1. ダイアログ ボックスで、マクロの名前と値を指定します。 必要に応じて、**[ビルド環境でこのマクロを環境変数として設定します]** チェック ボックスをオンにします。

## <a name="property-editor"></a>プロパティ エディター

プロパティ エディターを使用して、特定の文字列プロパティを変更し、値としてマクロを選択できます。 プロパティ エディターにアクセスするには、プロパティ ページのプロパティを選択し、右側のドロップダウン矢印をクリックします。 ドロップダウン リストに **[\<編集>]** が含まれている場合、それを選ぶと、そのプロパティのプロパティ エディターを表示できます。

![Property&#95;Editor&#95;Dropdown](../ide/media/property_editor_dropdown.png "Property_Editor_Dropdown")

プロパティ エディターで **[マクロ]** を選んで、使用できるマクロとその現在の値を見ることができます。 次の図は、**[マクロ]** を選んだ後の **[追加のインクルード ディレクトリ]** プロパティのプロパティ エディターを示したものです。 **[親またはプロジェクトの既定値から継承]** チェック ボックスをオンにして新しい値を追加すると、現在継承されているすべての値に追加されます。 チェック ボックスをオフにすると、継承された値が新しい値に置き換えられます。 ほとんどの場合、チェック ボックスはオンのままにします。

![プロパティ エディター、Visual C&#43;&#43;](../ide/media/propertyeditorvc.png "PropertyEditorVC")

##  <a name="bkmkPropertySheets"></a> 再利用可能なプロパティ構成の作成

ユーザー単位またはコンピューター単位で "global" プロパティを設定できますが、お勧めしません。 代わりに、**プロパティ マネージャー**を使って "*プロパティ シート*" を作成し、再利用したり他の人と共有したりする各種類のプロジェクトの設定を保存することをお勧めします。 また、プロパティ シートは、他の種類のプロジェクトのプロパティ設定が誤って変更されることを防止します。 プロパティ シートについて詳しくは、「[再利用可能なプロパティ構成の作成](#bkmkPropertySheets)」をご覧ください。

> [!IMPORTANT]
> **.user ファイルとそれが問題になる理由**
>
> Visual Studio の過去のバージョンでは、.user ファイル名拡張子を持ち、\<userprofile>\AppData\Local\Microsoft\MSBuild\v4.0\ フォルダーにある、グローバル プロパティ シートを使っていました。 これらのファイルは、ユーザー単位、コンピューター単位でプロジェクト構成のプロパティを設定するため、現在はお勧めしていません。 このような "global" 設定は、特にビルド コンピューター上で複数のプラットフォームを対象とする場合にビルドに影響する可能性があります。 たとえば、MFC プロジェクトと Windows Phone プロジェクトの両方を持つ場合は、.user プロパティはいずれか 1 つに対して無効となります。 再利用可能なプロパティ シートは、より柔軟で堅牢です。
>
> 現在も .user ファイルは Visual Studio によってインストールされ、プロパティ継承に参加しますが、既定では空です。 最も良い方法は、プロジェクトがすべてのユーザー単位、コンピューター単位の設定に関係なく動作するように、**プロパティ マネージャー** でそれらへの参照を削除することです。これは、SCC (ソース コード管理) 環境で適切な動作が行われるようにするために重要です。

**プロパティ マネージャー**を表示するには、メニュー バーで **[表示]**、**[その他のウィンドウ]**、**[プロパティ マネージャー]** の順に選びます。

複数のプロジェクトに適用する、よく使用される共通のプロパティ セットがある場合は、**プロパティ マネージャー**を使ってそれらを再利用可能な "*プロパティ シート*" ファイルにキャプチャできます。これは慣例により .props ファイル名拡張子を持ちます。 プロパティを最初から設定しなくても済むように、そのシートを新しいプロジェクトに適用できます。 **プロパティ マネージャー**にアクセスするには、メニュー バーで **[表示]**、**[プロパティ マネージャー]** の順に選びます。

![プロパティ マネージャー ショートカット メニュー](../ide/media/sharingnew.png "SharingNew")

各構成ノードの下には、その構成に適用される各プロパティ シートのノードが表示されます。 ユーザーがプロジェクトを作成すると、システムはアプリ ウィザードでユーザーが選んだオプションに基づいて値を設定するプロパティ シートを追加します。 任意のノードを右クリックして [プロパティ] を選ぶと、そのノードに適用されるプロパティが表示されます。 すべてのプロパティ シートは、プロジェクトの "マスター" プロパティ シート (ms.cpp.props) に自動的にインポートされ、プロパティ マネージャーに表示される順序で評価されます。 プロパティ マネージャーで移動することにより、評価順序を変更することができます。 後で評価されるプロパティ シートにより、前に評価されたシートの値はオーバーライドされます。

**[新しいプロジェクト プロパティ シートの追加]** を選択してから、たとえば MyProps.props プロパティ シートを選ぶと、プロパティ ページ ダイアログ ボックスが表示されます。 これは MyProps プロパティ シートに適用されることに注意してください。行った変更は、プロジェクト ファイル (.vcxproj) ではなくシートに書き込まれます。

.vcxproj ファイルで同じプロパティが直接設定されている場合、プロパティ シートのプロパティはオーバーライドされます。

必要に応じて何度でもプロパティ シートをインポートできます。 ソリューション内の複数のプロジェクトが同じプロパティ シートから設定を継承することができ、プロジェクトは複数のシートを持つことができます。 プロパティ シート自体は別のプロパティ シートから設定を継承できます。

また、複数の構成に対して 1 つのプロパティ シートを作成できます。 これを行うには、各構成のプロパティ シートを作成し、そのうちの 1 つのショートカット メニューを開き、**[既存のプロパティ シートの追加]** を選んで、他のシートを追加します。 ただし、1 つの共通のプロパティ シートを使用する場合は、プロパティを設定するときにシートが適用されるすべての構成セットが取得されることや、IDE では指定されたプロパティ シートから継承されるプロジェクトまたは他のプロパティ シートが表示されないことに注意してください。

多くのプロジェクトを持つ大規模なソリューションでは、ソリューション レベルでプロパティ シートを作成すると便利な場合があります。 ソリューションにプロジェクトを追加する場合、プロジェクトにそのプロパティ シートを追加するには、**プロパティ マネージャー**を使います。 プロジェクト レベルでの必要に応じて、新規プロパティ シートを追加してプロジェクト固有の値を設定できます。

> [!IMPORTANT]
> 既定では、.props ファイルはプロジェクト項目として作成されていないため、ソース管理に含まれません。 ソース管理に含める場合は、ソリューション項目として手動でファイルを追加できます。

#### <a name="to-create-a-property-sheet"></a>プロパティ シートを作成するには

1. メニュー バーで **[表示]**、**[プロパティ マネージャー]** の順に選びます。 **プロパティ マネージャー**が開きます。

2. プロパティ シートのスコープを定義するには、適用する項目を選択します。 これは、特定の構成または別のプロパティ シートです。 この項目のショートカット メニューを開き、**[新しいプロジェクト プロパティ シートの追加]** を選びます。 名前と場所を指定します。

3. **プロパティ マネージャー**で新しいプロパティ シートを開き、含めるプロパティを設定します。

##  <a name="bkmkPropertyInheritance"></a> プロパティの継承

プロジェクト プロパティは、レイヤー化されています。 各レイヤーは前のレイヤーの値を継承しますが、継承された値は、プロパティを明示的に設定することによりオーバーライドできます。 基本的な継承ツリーを次に示します。

1. MSBuild CPP ツールセットの既定の設定 (.vcxproj ファイルによってインポートされる ..\Program Files\MSBuild\Microsoft.Cpp\v4.0\Microsoft.Cpp.Default.props)

2. プロパティ シート

3. .vcxproj ファイル (既定値とプロパティ シートの設定をオーバーライド可能)。

4. 項目メタデータ

> [!TIP]
> プロパティ ページで、`bold` のプロパティは現在のコンテキストで定義されています。 通常フォントのプロパティが継承されます。

プロジェクト ファイル (.vcxproj) は、ビルド時に他のプロパティ シートをインポートします。 すべてのプロパティ シートがインポートされた後、プロジェクト ファイルが評価され、プロパティ値の最後の定義が使用されます。 指定したプロパティ値がどのように継承されているかを特定するために、拡張されたファイルを表示すると便利な場合があります。 拡張されたバージョンを表示するには、Visual Studio コマンド プロンプトで次のコマンドを入力します (プレースホルダー ファイル名を適宜変更してください)。

**msbuild /pp:** *temp* **.txt** *myapp* **.vcxproj**

拡張されたプロジェクト ファイルは大きく、MSBuild に詳しくない場合は理解するのが難しい可能性があります。 プロジェクト ファイルの基本的な構造を次に示します。

1. IDE では公開されていない基本的なプロジェクトのプロパティ。

2. ツールセットに依存しない一部の基本的なプロパティを定義する Microsoft.cpp.default.props のインポート。

3. グローバル構成プロパティ (**[Configuration General]\(構成概要\)** ページの **[PlatformToolset]** および **[プロジェクト]** 既定プロパティとして公開されます)。 これらのプロパティは、次の手順の Microsoft.cpp.props でインポートされるツールセットおよび組み込みプロパティ シートを決定します。

4. プロジェクトのほとんどの既定値を設定する Microsoft.cpp.props のインポート。

5. .user を含むすべてのプロパティ シートのインポート。 これらのプロパティ シートは、**[PlatformToolset]** および **[プロジェクト]** の既定プロパティを除くすべてをオーバーライドできます。

6. プロジェクト構成プロパティの残り。 これらの値は、プロパティ シートの設定をオーバーライドできます。

7. 項目 (ファイル) とそのメタデータ。 これらは、他のプロパティやインポートの前に発生した場合でも、常に MSBuild 評価規則の最後の単語です。

詳細については、「[MSBuild プロパティ](/visualstudio/msbuild/msbuild-properties)」を参照してください。

## <a name="adding-an-include-directory-to-the-set-of-default-directories"></a>既定のディレクトリ セットへのインクルード ディレクトリの追加

プロジェクトにインクルード ディレクトリを追加する場合、すべての既定のディレクトリをオーバーライドしないことが重要です。 ディレクトリを追加するための正しい方法は、"C:\MyNewIncludeDir\" のような新しいパスを追加し、プロパティ値に **$(IncludePath)** マクロを追加することです。

## <a name="setting-environment-variables-for-a-build"></a>ビルドの環境変数の設定

Visual C++ コンパイラ (cl.exe) は、特定の環境変数、特に LIB、LIBPATH、PATH、および INCLUDE を認識します。 IDE でビルドすると、[VC++ ディレクトリのプロパティ ページ](../ide/vcpp-directories-property-page.md)で設定されたプロパティを使用して環境変数が設定されます。 LIB、LIBPATH、および INCLUDE の値が既に設定されている場合 (たとえば、開発者コマンド プロンプトによって)、それらは対応する MSBuild プロパティの値に置き換えられます。 その後、ビルドによって、VC++ ディレクトリの実行ファイル ディレクトリのプロパティの値が PATH に追加されます。 ユーザー定義マクロを作成して **[ビルド環境でこのマクロを環境変数として設定します]** チェック ボックスをオンにすると、ユーザー定義の環境変数を設定できます。

## <a name="setting-environment-variables-for-a-debugging-session"></a>デバッグ セッションの環境変数の設定

プロジェクトの **[プロパティ ページ]** ダイアログ ボックスの左ウィンドウで **[構成プロパティ]** を展開し、**[デバッグ]** を選びます。

右ウィンドウで **[環境]** または **[マージ環境]** のプロジェクト設定を変更して、**[OK]** をクリックします。

## <a name="modifying-properties-and-targets-without-changing-the-project-file"></a>プロジェクト ファイルを変更しないでプロパティとターゲットを変更する

プロジェクト ファイルを変更することなく、MSBuild のコマンド プロンプトからプロジェクトのプロパティとターゲットをオーバーライドできます。 これは、一時的に、またはときどき一部のプロパティを適用する場合に便利です。 MSBuild のある程度の知識が必要です。 詳しくは、「[MSBuild](https://docs.microsoft.com/visualstudio/msbuild/msbuild)」をご覧ください。

> [!IMPORTANT]
> Visual Studio の XML エディターまたは任意のテキスト エディターを使って、.props ファイルまたは .targets ファイルを作成します。 **プロパティ マネージャー**はプロジェクト ファイルにプロパティを追加するため、このシナリオでは使わないでください。

*プロジェクトのプロパティをオーバーライドするには:*

1. オーバーライドするプロパティを指定する .props ファイルを作成します。

1. コマンド プロンプトから、ForceImportBeforeCppTargets="C:\sources\my_props.props" を設定します

*プロジェクトのターゲットをオーバーライドするには:*

1. 実装または特定のターゲットの .targets ファイルを作成します

2. コマンド プロンプトから、ForceImportAfterCppTargets ="C:\sources\my_target.targets" を設定します

msbuild のコマンド ラインで /p: オプションを使って、いずれかのオプションを設定することもできます。

```cmd
> msbuild myproject.sln /p:ForceImportBeforeCppTargets="C:\sources\my_props.props"
> msbuild myproject.sln /p:ForceImportAfterCppTargets="C:\sources\my_target.targets"
```

この方法でプロパティとターゲットをオーバーライドするのは、ソリューション内のすべての .vcxproj ファイルに次のインポートを追加することと同じです。

```cmd
<Import Project=="C:\sources\my_props.props" />
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
<Import Project==" C:\sources\my_target.targets"" />
```

## <a name="see-also"></a>関連項目

[Visual C++ プロジェクトの作成と管理](../ide/creating-and-managing-visual-cpp-projects.md)<br/>
[.vcxproj と .props のファイル構造](vcxproj-file-structure.md)<br/>
[プロパティ ページの XML ファイル](property-page-xml-files.md)<br/>
